<!--
# === FILE META OPENING ===
# file: ./timeseries-frontend/templates/timeseries/results.html
# role: frontend
# desc: main results page template that displays server-side processed analysis results with minimal JavaScript
# === FILE META CLOSING ===
-->

{% extends 'base.html' %}
{% load static %}
{% load dict_extras %}

{% block title %}Lab:Results{% endblock %}

{% block extra_css %}
<style>
    /* Hide HTMX indicators by default */
    .htmx-indicator {
        display: none;
    }
    
    /* Show HTMX indicators only during requests */
    .htmx-request .htmx-indicator {
        display: inline-block;
    }
    
    /* Additional styling for better UX */
    .plotly-chart {
        min-height: 400px;
    }
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="mb-0">Analysis Results</h1>
    <div class="btn-group" role="group">
        <a href="{% url 'timeseries:download_api_response' %}" class="btn btn-outline-primary">
            <i class="bi bi-download"></i> Download API response
        </a>
        <a href="{% url 'timeseries:view_api_response_popup' %}" target="_blank" class="btn btn-outline-secondary">
            <i class="bi bi-eye"></i> View API response
        </a>
    </div>
</div>

{% if no_results %}
<div class="alert alert-warning">
    <h4><i class="bi bi-exclamation-triangle"></i> No Results Found</h4>
    <p>{{ error_message }}</p>
    <a href="{% url 'timeseries:analysis' %}" class="btn btn-primary">Go to Analysis</a>
</div>
{% else %}

<!-- Main Navigation Tabs -->
<ul class="nav nav-tabs mb-4" id="resultsTabs" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link {% if active_tab == 'overview' %}active{% endif %}" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" 
                type="button" role="tab" aria-controls="overview" aria-selected="{% if active_tab == 'overview' %}true{% else %}false{% endif %}">
            <i class="bi bi-speedometer2"></i> Overview
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link {% if active_tab == 'execution-config' %}active{% endif %}" id="execution-config-tab" data-bs-toggle="tab" data-bs-target="#execution-config" 
                type="button" role="tab" aria-controls="execution-config" aria-selected="{% if active_tab == 'execution-config' %}true{% else %}false{% endif %}">
            <i class="bi bi-gear"></i> Configuration
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link {% if active_tab == 'time-series' %}active{% endif %}" id="time-series-tab" data-bs-toggle="tab" data-bs-target="#time-series" 
                type="button" role="tab" aria-controls="time-series" aria-selected="{% if active_tab == 'time-series' %}true{% else %}false{% endif %}">
            <i class="bi bi-graph-up"></i> Series
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link {% if active_tab == 'statistical-tests' %}active{% endif %}" id="statistical-tests-tab" data-bs-toggle="tab" data-bs-target="#statistical-tests" 
                type="button" role="tab" aria-controls="statistical-tests" aria-selected="{% if active_tab == 'statistical-tests' %}true{% else %}false{% endif %}">
            <i class="bi bi-calculator"></i> Statistical Tests
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link {% if active_tab == 'arima' %}active{% endif %}" id="arima-tab" data-bs-toggle="tab" data-bs-target="#arima" 
                type="button" role="tab" aria-controls="arima" aria-selected="{% if active_tab == 'arima' %}true{% else %}false{% endif %}">
            <i class="bi bi-graph-up-arrow"></i> ARIMA
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link {% if active_tab == 'garch' %}active{% endif %}" id="garch-tab" data-bs-toggle="tab" data-bs-target="#garch" 
                type="button" role="tab" aria-controls="garch" aria-selected="{% if active_tab == 'garch' %}true{% else %}false{% endif %}">
            <i class="bi bi-lightning"></i> GARCH
        </button>
    </li>
    {% if spillover_enabled %}
    <li class="nav-item" role="presentation">
        <button class="nav-link {% if active_tab == 'spillover' %}active{% endif %}" id="spillover-tab" data-bs-toggle="tab" data-bs-target="#spillover" 
                type="button" role="tab" aria-controls="spillover" aria-selected="{% if active_tab == 'spillover' %}true{% else %}false{% endif %}">
            <i class="bi bi-arrows-angle-expand"></i> Spillover Analysis
        </button>
    </li>
    {% endif %}
    <li class="nav-item" role="presentation">
        <button class="nav-link {% if active_tab == 'granger-causality' %}active{% endif %}" id="granger-causality-tab" data-bs-toggle="tab" data-bs-target="#granger-causality"
                type="button" role="tab" aria-controls="granger-causality" aria-selected="{% if active_tab == 'granger-causality' %}true{% else %}false{% endif %}">
            <i class="bi bi-arrow-through-heart"></i> Causality
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link {% if active_tab == 'explainer' %}active{% endif %}" id="explainer-tab" data-bs-toggle="tab" data-bs-target="#explainer" 
                type="button" role="tab" aria-controls="explainer" aria-selected="{% if active_tab == 'explainer' %}true{% else %}false{% endif %}">
            <i class="bi bi-question-circle"></i> Concepts
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link {% if active_tab == 'data-lineage' %}active{% endif %}" id="data-lineage-tab" data-bs-toggle="tab" data-bs-target="#data-lineage-pane" 
                type="button" role="tab" aria-controls="data-lineage-pane" aria-selected="{% if active_tab == 'data-lineage' %}true{% else %}false{% endif %}">
            <i class="bi bi-diagram-3"></i> Provenance
        </button>
    </li>
</ul>

<div class="tab-content" id="resultsTabsContent">
    
    <!-- Overview Tab -->
    <div class="tab-pane fade {% if active_tab == 'overview' %}show active{% endif %}" id="overview" role="tabpanel" aria-labelledby="overview-tab">
        <div class="row">
            <div class="col-12">
                <!-- Executive Summary Card -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0"><i class="bi bi-briefcase"></i> Executive Summary</h5>
                    </div>
                    <div class="card-body">
                        {% if executive_summary.stationarity_summary %}
                            <div class="card mb-3">
                                <div class="card-header bg-primary text-white">
                                    <h6 class="mb-0"><i class="bi bi-activity"></i> Stationarity Analysis Summary</h6>
                                </div>
                                <div class="card-body">
                                    {% for symbol, details in executive_summary.stationarity_summary.items %}
                                        <div class="border-start border-primary border-3 ps-3 mb-3">
                                            <h6 class="text-primary mb-2">{{ symbol|upper }}</h6>
                                            {% if details.interpretation.executive_summary.justification %}
                                                <p class="mb-0"><strong>Interpretation:</strong> {{ details.interpretation.executive_summary.justification }}</p>
                                            {% else %}
                                                <ul class="mb-0">
                                                    {% for key, value in details.items %}
                                                        <li><strong>{{ key|title|replace_underscore }}:</strong> {{ value }}</li>
                                                    {% endfor %}
                                                </ul>
                                            {% endif %}
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        {% endif %}
                        
                        {% if arima_results %}
                            <div class="card mb-3">
                                <div class="card-header bg-success text-white">
                                    <h6 class="mb-0"><i class="bi bi-graph-up-arrow"></i> ARIMA Analysis Summary</h6>
                                </div>
                                <div class="card-body">
                                    {% for symbol, arima_data in arima_results.items %}
                                        <div class="border-start border-success border-3 ps-3 mb-3">
                                            <h6 class="text-success mb-2">{{ symbol|upper }}</h6>
                                            {% if arima_data.interpretation.executive_summary %}
                                                {% if arima_data.interpretation.executive_summary.bottom_line %}
                                                    <p class="mb-1"><strong>Summary:</strong> {{ arima_data.interpretation.executive_summary.bottom_line }}</p>
                                                {% endif %}
                                                {% if arima_data.interpretation.executive_summary.business_impact %}
                                                    <p class="mb-1"><strong>Business Impact:</strong> {{ arima_data.interpretation.executive_summary.business_impact }}</p>
                                                {% endif %}
                                                {% if arima_data.interpretation.executive_summary.recommendation %}
                                                    <p class="mb-1"><strong>Recommendation:</strong> {{ arima_data.interpretation.executive_summary.recommendation }}</p>
                                                {% endif %}
                                                {% if arima_data.interpretation.executive_summary.justification %}
                                                    <p class="mb-1"><strong>Justification:</strong> {{ arima_data.interpretation.executive_summary.justification }}</p>
                                                {% endif %}
                                            {% else %}
                                                <p class="mb-1"><strong>Model:</strong> {{ arima_data.summary.model_specification|default:"N/A" }}</p>
                                                <p class="mb-1"><strong>AIC:</strong> {{ arima_data.summary.aic|floatformat:2|default:"N/A" }}</p>
                                                <p class="mb-0"><strong>Forecast Steps:</strong> {{ arima_data.forecast.forecast_steps|default:"N/A" }}</p>
                                            {% endif %}
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        {% endif %}
                        
                        {% if executive_summary.garch_summary %}
                            <div class="card mb-3">
                                <div class="card-header bg-warning text-dark">
                                    <h6 class="mb-0"><i class="bi bi-lightning"></i> GARCH Analysis Summary</h6>
                                </div>
                                <div class="card-body">
                                    {% for symbol, garch_data in garch_results.items %}
                                        <div class="border-start border-warning border-3 ps-3 mb-3">
                                            <h6 class="text-warning mb-2">{{ symbol|upper }}</h6>
                                            {% if garch_data.interpretation.executive_summary %}
                                                {% if garch_data.interpretation.executive_summary.bottom_line %}
                                                    <p class="mb-1"><strong>Summary:</strong> {{ garch_data.interpretation.executive_summary.bottom_line }}</p>
                                                {% endif %}
                                                {% if garch_data.interpretation.executive_summary.business_impact %}
                                                    <p class="mb-1"><strong>Business Impact:</strong> {{ garch_data.interpretation.executive_summary.business_impact }}</p>
                                                {% endif %}
                                                {% if garch_data.interpretation.executive_summary.recommendation %}
                                                    <p class="mb-1"><strong>Recommendation:</strong> {{ garch_data.interpretation.executive_summary.recommendation }}</p>
                                                {% endif %}
                                                {% if garch_data.interpretation.executive_summary.justification %}
                                                    <p class="mb-0"><strong>Justification:</strong> {{ garch_data.interpretation.executive_summary.justification }}</p>
                                                {% endif %}
                                            {% else %}
                                                <p class="mb-1"><strong>Model Type:</strong> GARCH</p>
                                                <p class="mb-1"><strong>Forecast Periods:</strong> {{ garch_data.forecast|length|default:"N/A" }}</p>
                                                <p class="mb-0"><strong>Next Period Volatility:</strong> {{ garch_data.forecast.0|floatformat:6|default:"N/A" }}</p>
                                            {% endif %}
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        {% endif %}
                        
                        {% if spillover_results %}
                            <div class="card mb-3">
                                <div class="card-header bg-info text-white">
                                    <h6 class="mb-0"><i class="bi bi-arrows-angle-expand"></i> Spillover Analysis Summary</h6>
                                </div>
                                <div class="card-body">
                                    {% if spillover_results.total_spillover_index %}
                                        <div class="alert alert-info mb-3">
                                            <strong>Total Spillover Index:</strong> {{ spillover_results.total_spillover_index|floatformat:2 }}%
                                            <br><small>Percentage of forecast error variance from cross-asset spillovers</small>
                                        </div>
                                    {% endif %}
                                    
                                    {% if spillover_results.directional_spillover %}
                                        <h6 class="text-info mb-2">Directional Spillover Effects</h6>
                                        {% for symbol, spillover_data in spillover_results.directional_spillover.items %}
                                            <div class="border-start border-info border-3 ps-3 mb-2">
                                                <strong>{{ symbol|upper }}:</strong>
                                                <span class="text-muted">TO {{ spillover_data.to|floatformat:1 }}% | FROM {{ spillover_data.from|floatformat:1 }}%</span>
                                            </div>
                                        {% endfor %}
                                    {% endif %}
                                    
                                    {% if spillover_results.net_spillover %}
                                        <h6 class="text-info mb-2 mt-3">Net Spillover Effects</h6>
                                        {% for symbol, net_value in spillover_results.net_spillover.items %}
                                            <div class="border-start border-info border-3 ps-3 mb-2">
                                                <strong>{{ symbol|upper }}:</strong>
                                                {% if net_value > 0 %}
                                                    <span class="text-success">+{{ net_value|floatformat:1 }}% (Net Transmitter)</span>
                                                {% elif net_value < 0 %}
                                                    <span class="text-danger">{{ net_value|floatformat:1 }}% (Net Receiver)</span>
                                                {% else %}
                                                    <span class="text-muted">{{ net_value|floatformat:1 }}% (Neutral)</span>
                                                {% endif %}
                                            </div>
                                        {% endfor %}
                                    {% endif %}
                                </div>
                            </div>
                        {% endif %}
                        
                        {% if var_results.fevd_interpretation %}
                            <div class="card mb-3">
                                <div class="card-header bg-secondary text-white">
                                    <h6 class="mb-0"><i class="bi bi-diagram-3"></i> Forecast Error Variance Decomposition (FEVD)</h6>
                                </div>
                                <div class="card-body">
                                    {% for symbol, interpretation in var_results.fevd_interpretation.items %}
                                        <div class="border-start border-secondary border-3 ps-3 mb-3">
                                            <h6 class="text-secondary mb-2">{{ symbol|upper }}</h6>
                                            <p class="mb-0 small">{{ interpretation }}</p>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        {% endif %}
                        
                        {% if granger_causality_results.causality_results %}
                            <div class="card mb-3">
                                <div class="card-header bg-dark text-white">
                                    <h6 class="mb-0"><i class="bi bi-arrow-through-heart"></i> Granger Causality Summary</h6>
                                </div>
                                <div class="card-body">
                                    {% with total_pairs=granger_causality_results.causality_results|length %}
                                        {% with significant_5pct=0 significant_1pct=0 %}
                                            {% for relationship, test in granger_causality_results.causality_results.items %}
                                                {% if test.significance_summary.significant_at_5pct %}
                                                    {% with significant_5pct=significant_5pct|add:1 %}{% endwith %}
                                                {% endif %}
                                                {% if test.significance_summary.significant_at_1pct %}
                                                    {% with significant_1pct=significant_1pct|add:1 %}{% endwith %}
                                                {% endif %}
                                            {% endfor %}
                                            
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <div class="text-center">
                                                        <h5 class="text-dark mb-1">{{ total_pairs }}</h5>
                                                        <small class="text-muted">Total Pairs Tested</small>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="text-center">
                                                        <h5 class="text-warning mb-1">{{ granger_causality_results.metadata.significant_at_5pct|default:0 }}</h5>
                                                        <small class="text-muted">Significant at 5%</small>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="text-center">
                                                        <h5 class="text-danger mb-1">{{ granger_causality_results.metadata.significant_at_1pct|default:0 }}</h5>
                                                        <small class="text-muted">Significant at 1%</small>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            {% if spillover_results.interpretation %}
                                                <div class="alert alert-light mt-3 mb-0">
                                                    <small><strong>Analysis Summary:</strong> {{ spillover_results.interpretation }}</small>
                                                </div>
                                            {% endif %}
                                        {% endwith %}
                                    {% endwith %}
                                </div>
                            </div>
                        {% endif %}
                        
                        {% if multivariate_garch_results.cc_correlation %}
                            <div class="card mb-3">
                                <div class="card-header bg-success text-white">
                                    <h6 class="mb-0"><i class="bi bi-grid-3x3"></i> Multivariate GARCH Correlation Matrix</h6>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-sm table-bordered">
                                            <thead class="table-light">
                                                <tr>
                                                    <th></th>
                                                    {% for symbol in symbols %}
                                                        <th class="text-center">{{ symbol }}</th>
                                                    {% endfor %}
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for row_symbol in symbols %}
                                                    <tr>
                                                        <th class="bg-light">{{ row_symbol }}</th>
                                                        {% for col_symbol in symbols %}
                                                            <td class="text-center">
                                                                {% if row_symbol == col_symbol %}
                                                                    <strong>1.000</strong>
                                                                {% else %}
                                                                    {% with correlation=multivariate_garch_results.cc_correlation|lookup:row_symbol|lookup:col_symbol %}
                                                                        {% if correlation > 0.7 %}
                                                                            <span class="text-success"><strong>{{ correlation|floatformat:3 }}</strong></span>
                                                                        {% elif correlation > 0.3 %}
                                                                            <span class="text-warning">{{ correlation|floatformat:3 }}</span>
                                                                        {% else %}
                                                                            <span class="text-muted">{{ correlation|floatformat:3 }}</span>
                                                                        {% endif %}
                                                                    {% endwith %}
                                                                {% endif %}
                                                            </td>
                                                        {% endfor %}
                                                    </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="mt-2">
                                        <small class="text-muted">
                                            <span class="text-success">■</span> High correlation (>0.7) &nbsp;
                                            <span class="text-warning">■</span> Moderate correlation (0.3-0.7) &nbsp;
                                            <span class="text-muted">■</span> Low correlation (<0.3)
                                        </small>
                                    </div>
                                    
                                    {% if multivariate_garch_results.interpretations.CCC_GARCH %}
                                        <div class="alert alert-light mt-3 mb-0">
                                            <small><strong>CCC-GARCH Interpretation:</strong> {{ multivariate_garch_results.interpretations.CCC_GARCH|truncatechars:300 }}</small>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        {% endif %}
                        
                        {% if var_results.interpretation %}
                            <div class="card mb-3">
                                <div class="card-header bg-primary text-white">
                                    <h6 class="mb-0"><i class="bi bi-bezier2"></i> Vector Autoregression (VAR) Summary</h6>
                                </div>
                                <div class="card-body">
                                    {% if var_results.selected_lag %}
                                        <div class="mb-2">
                                            <strong>Selected Lag:</strong> {{ var_results.selected_lag }}
                                            {% if var_results.ic_used %}
                                                <small class="text-muted">({{ var_results.ic_used }} criterion)</small>
                                            {% endif %}
                                        </div>
                                    {% endif %}
                                    
                                    <div class="alert alert-light mb-0">
                                        <small>{{ var_results.interpretation }}</small>
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Execution Configuration Tab -->
    <div class="tab-pane fade {% if active_tab == 'execution-config' %}show active{% endif %}" id="execution-config" role="tabpanel" aria-labelledby="execution-config-tab">
        <div class="alert alert-info mb-4">
            <i class="bi bi-info-circle"></i>
            <strong>Analysis Configuration:</strong> This section shows all the parameters and settings that were used to execute this analysis.
        </div>
        
        <!-- Data Source Configuration -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="bi bi-database"></i> Data Source Configuration</h5>
            </div>
            <div class="card-body">
                {% if execution_configuration.data_source %}
                    <table class="table table-sm">
                        {% for key, value in execution_configuration.data_source.items %}
                        <tr>
                            <td><strong>{{ key|title }}:</strong></td>
                            <td>{{ value }}</td>
                        </tr>
                        {% endfor %}
                    </table>
                {% else %}
                    <p class="text-muted">No data source configuration available.</p>
                {% endif %}
            </div>
        </div>
        
        <!-- Model Configurations -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="bi bi-cpu"></i> Model Configurations</h5>
            </div>
            <div class="card-body">
                {% if execution_configuration.model_configurations %}
                    <div class="row">
                        <div class="col-md-6">
                            <h6><i class="bi bi-graph-up-arrow"></i> ARIMA Parameters</h6>
                            {% if execution_configuration.model_configurations.arima_params %}
                                <table class="table table-sm">
                                    {% for key, value in execution_configuration.model_configurations.arima_params.items %}
                                    <tr>
                                        <td><strong>{{ key }}:</strong></td>
                                        <td>{{ value }}</td>
                                    </tr>
                                    {% endfor %}
                                </table>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <h6><i class="bi bi-lightning"></i> GARCH Parameters</h6>
                            {% if execution_configuration.model_configurations.garch_params %}
                                <table class="table table-sm">
                                    {% for key, value in execution_configuration.model_configurations.garch_params.items %}
                                    <tr>
                                        <td><strong>{{ key }}:</strong></td>
                                        <td>{{ value }}</td>
                                    </tr>
                                    {% endfor %}
                                </table>
                            {% endif %}
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Data Processing Configuration -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="bi bi-sliders"></i> Data Processing Configuration</h5>
            </div>
            <div class="card-body">
                {% if execution_configuration.data_processing %}
                    <table class="table table-sm">
                        {% for key, value in execution_configuration.data_processing.items %}
                        <tr>
                            <td><strong>{{ key|title|replace_underscore }}:</strong></td>
                            <td>{{ value }}</td>
                        </tr>
                        {% endfor %}
                    </table>
                {% else %}
                    <p class="text-muted">No data processing configuration available.</p>
                {% endif %}
            </div>
        </div>
        
        <!-- Spillover Configuration -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="bi bi-shuffle"></i> Spillover Configuration</h5>
            </div>
            <div class="card-body">
                {% if execution_configuration.spillover_configuration %}
                    <table class="table table-sm">
                        {% for key, value in execution_configuration.spillover_configuration.items %}
                        <tr>
                            <td><strong>{{ key|title|replace_underscore }}:</strong></td>
                            <td>{{ value }}</td>
                        </tr>
                        {% endfor %}
                    </table>
                {% else %}
                    <p class="text-muted">No spillover configuration available.</p>
                {% endif %}
            </div>
        </div>
        
        <!-- Execution Metadata -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="bi bi-clock-history"></i> Execution Metadata</h5>
            </div>
            <div class="card-body">
                {% if execution_configuration.execution_metadata %}
                    <table class="table table-sm">
                        {% for key, value in execution_configuration.execution_metadata.items %}
                        <tr>
                            <td><strong>{{ key|title|replace_underscore }}:</strong></td>
                            <td>{{ value }}</td>
                        </tr>
                        {% endfor %}
                    </table>
                {% else %}
                    <p class="text-muted">No execution metadata available.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Time Series Tab -->
    <div class="tab-pane fade {% if active_tab == 'time-series' %}show active{% endif %}" id="time-series" role="tabpanel" aria-labelledby="time-series-tab">
        <!-- Original Data Visualization -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="bi bi-graph-up me-2"></i> Original Price Data Visualization</h5>
            </div>
            <div class="card-body">
                <div class="alert alert-info mb-3">
                    <i class="bi bi-info-circle"></i>
                    <strong>Time Series Analysis:</strong> This section provides interactive visualizations of the original price data used in the analysis. The chart below shows price movements over time for all analyzed symbols.
                </div>
                
                {% if plots.original_data_stats %}
                    <div id="original-data-plot" class="plotly-chart"></div>
                    <script>
                        document.addEventListener('DOMContentLoaded', function() {
                            try {
                                var plotData = {{ plots.original_data_stats|safe }};
                                Plotly.newPlot('original-data-plot', plotData.data, plotData.layout, {
                                    responsive: true,
                                    displayModeBar: true,
                                    displaylogo: false,
                                    modeBarButtonsToRemove: ['pan2d', 'lasso2d', 'select2d']
                                });
                            } catch (error) {
                                console.error('Error rendering original data plot:', error);
                                document.getElementById('original-data-plot').innerHTML = 
                                    '<div class="alert alert-warning">Error loading chart. Please try refreshing the page.</div>';
                            }
                        });
                    </script>
                {% else %}
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i>
                        <strong>Chart Not Available:</strong> Original data visualization could not be generated. This may be due to missing data or processing issues.
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Returns Data Visualization -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="bi bi-activity me-2"></i> Returns Data Visualization</h5>
            </div>
            <div class="card-body">
                <div class="alert alert-info mb-3">
                    <i class="bi bi-info-circle"></i>
                    <strong>Returns Analysis:</strong> Logarithmic returns calculated from the original price data. Returns show the percentage change in prices and are used for risk analysis and modeling.
                </div>
                
                {% if plots.returns_data_plot %}
                    <div id="returns-data-plot" class="plotly-chart"></div>
                    <script>
                        document.addEventListener('DOMContentLoaded', function() {
                            try {
                                var plotData = {{ plots.returns_data_plot|safe }};
                                Plotly.newPlot('returns-data-plot', plotData.data, plotData.layout, {
                                    responsive: true,
                                    displayModeBar: true,
                                    displaylogo: false,
                                    modeBarButtonsToRemove: ['pan2d', 'lasso2d', 'select2d']
                                });
                            } catch (error) {
                                console.error('Error rendering returns plot:', error);
                                document.getElementById('returns-data-plot').innerHTML = 
                                    '<div class="alert alert-warning">Error loading chart. Please try refreshing the page.</div>';
                            }
                        });
                    </script>
                {% else %}
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i>
                        <strong>Chart Not Available:</strong> Returns data visualization could not be generated.
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Scaled Data Visualization -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="bi bi-arrows-fullscreen me-2"></i> Scaled Data Visualization</h5>
            </div>
            <div class="card-body">
                <div class="alert alert-info mb-3">
                    <i class="bi bi-info-circle"></i>
                    <strong>Scaled Data:</strong> Standardized returns data prepared for GARCH modeling. This normalization helps ensure model stability and comparability across different assets.
                </div>
                
                {% if plots.scaled_data_plot %}
                    <div id="scaled-data-plot" class="plotly-chart"></div>
                    <script>
                        document.addEventListener('DOMContentLoaded', function() {
                            try {
                                var plotData = {{ plots.scaled_data_plot|safe }};
                                Plotly.newPlot('scaled-data-plot', plotData.data, plotData.layout, {
                                    responsive: true,
                                    displayModeBar: true,
                                    displaylogo: false,
                                    modeBarButtonsToRemove: ['pan2d', 'lasso2d', 'select2d']
                                });
                            } catch (error) {
                                console.error('Error rendering scaled data plot:', error);
                                document.getElementById('scaled-data-plot').innerHTML = 
                                    '<div class="alert alert-warning">Error loading chart. Please try refreshing the page.</div>';
                            }
                        });
                    </script>
                {% else %}
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i>
                        <strong>Chart Not Available:</strong> Scaled data visualization could not be generated.
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Pre-GARCH Data Visualization -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="bi bi-box-arrow-in-right me-2"></i> Pre-GARCH Data Visualization</h5>
            </div>
            <div class="card-body">
                <div class="alert alert-info mb-3">
                    <i class="bi bi-info-circle"></i>
                    <strong>Pre-GARCH Data:</strong> Data prepared and ready for GARCH model input. This represents the final preprocessing step before volatility modeling.
                </div>
                
                {% if plots.pre_garch_plot %}
                    <div id="pre-garch-plot" class="plotly-chart"></div>
                    <script>
                        document.addEventListener('DOMContentLoaded', function() {
                            try {
                                var plotData = {{ plots.pre_garch_plot|safe }};
                                Plotly.newPlot('pre-garch-plot', plotData.data, plotData.layout, {
                                    responsive: true,
                                    displayModeBar: true,
                                    displaylogo: false,
                                    modeBarButtonsToRemove: ['pan2d', 'lasso2d', 'select2d']
                                });
                            } catch (error) {
                                console.error('Error rendering pre-GARCH plot:', error);
                                document.getElementById('pre-garch-plot').innerHTML = 
                                    '<div class="alert alert-warning">Error loading chart. Please try refreshing the page.</div>';
                            }
                        });
                    </script>
                {% else %}
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i>
                        <strong>Chart Not Available:</strong> Pre-GARCH data visualization could not be generated.
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Post-GARCH Data Visualization -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="bi bi-box-arrow-right me-2"></i> Post-GARCH Data Visualization</h5>
            </div>
            <div class="card-body">
                <div class="alert alert-info mb-3">
                    <i class="bi bi-info-circle"></i>
                    <strong>Post-GARCH Data:</strong> Data after GARCH volatility modeling and residual extraction. This shows the final processed data with volatility clustering effects captured.
                </div>
                
                {% if plots.post_garch_plot %}
                    <div id="post-garch-plot" class="plotly-chart"></div>
                    <script>
                        document.addEventListener('DOMContentLoaded', function() {
                            try {
                                var plotData = {{ plots.post_garch_plot|safe }};
                                Plotly.newPlot('post-garch-plot', plotData.data, plotData.layout, {
                                    responsive: true,
                                    displayModeBar: true,
                                    displaylogo: false,
                                    modeBarButtonsToRemove: ['pan2d', 'lasso2d', 'select2d']
                                });
                            } catch (error) {
                                console.error('Error rendering post-GARCH plot:', error);
                                document.getElementById('post-garch-plot').innerHTML = 
                                    '<div class="alert alert-warning">Error loading chart. Please try refreshing the page.</div>';
                            }
                        });
                    </script>
                {% else %}
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i>
                        <strong>Chart Not Available:</strong> Post-GARCH data visualization could not be generated.
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Statistical Tests Tab -->
    <div class="tab-pane fade {% if active_tab == 'statistical-tests' %}show active{% endif %}" id="statistical-tests" role="tabpanel" aria-labelledby="statistical-tests-tab">
        <!-- Stationarity Tests -->
        <div class="card mb-4">
            <div class="card-header bg-gradient text-white" style="background: linear-gradient(135deg, #6c5ce7, #74b9ff);">
                <h5 class="card-title mb-0">
                    <i class="bi bi-activity me-2"></i> 
                    Stationarity Tests (Augmented Dickey-Fuller)
                </h5>
                <small class="opacity-75">Statistical tests to determine if time series data has constant statistical properties over time</small>
            </div>
            <div class="card-body p-0">
                {% if stationarity_results.all_symbols_stationarity %}
                    <div class="row g-0">
                        {% for symbol, test in stationarity_results.all_symbols_stationarity.items %}
                            <div class="col-lg-6 col-xl-4">
                                <div class="card border-0 border-end border-bottom h-100" style="border-color: #e9ecef !important;">
                                    <div class="card-header bg-light border-0 d-flex align-items-center justify-content-between">
                                        <div>
                                            <h6 class="mb-0 fw-bold text-dark">{{ symbol|upper }}</h6>
                                            <small class="text-muted">Stationarity Test Results</small>
                                        </div>
                                        <div class="text-end">
                                            {% if test.is_stationary %}
                                                <span class="badge bg-success rounded-pill px-3 py-2">
                                                    <i class="bi bi-check-circle me-1"></i>Stationary
                                                </span>
                                            {% else %}
                                                <span class="badge bg-warning text-dark rounded-pill px-3 py-2">
                                                    <i class="bi bi-exclamation-triangle me-1"></i>Non-Stationary
                                                </span>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <!-- Test Statistics Section -->
                                        <div class="mb-4">
                                            <h6 class="text-primary mb-3 d-flex align-items-center">
                                                <i class="bi bi-bar-chart-line me-2"></i>Test Statistics
                                            </h6>
                                            <div class="row g-3">
                                                <div class="col-6">
                                                    <div class="bg-light rounded p-3 text-center">
                                                        <div class="fw-bold text-dark">{{ test.adf_statistic|floatformat:4 }}</div>
                                                        <small class="text-muted">ADF Statistic</small>
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="bg-light rounded p-3 text-center">
                                                        <div class="fw-bold text-dark">{{ test.p_value|floatformat:6 }}</div>
                                                        <small class="text-muted">P-value</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Critical Values Section -->
                                        <div>
                                            <h6 class="text-primary mb-3 d-flex align-items-center">
                                                <i class="bi bi-target me-2"></i>Critical Values
                                            </h6>
                                            {% if test.critical_values %}
                                                <div class="space-y-2">
                                                    {% for level, value in test.critical_values.items %}
                                                        <div class="d-flex justify-content-between align-items-center p-2 rounded" 
                                                             style="background-color: {% if test.adf_statistic < value %}#d4edda{% else %}#f8d7da{% endif %};">
                                                            <div class="d-flex align-items-center">
                                                                {% if test.adf_statistic < value %}
                                                                    <span class="text-success me-2 fs-5">✅</span>
                                                                    <span class="text-success fw-medium">Critical Value ({{ level }})</span>
                                                                {% else %}
                                                                    <span class="text-danger me-2 fs-5">❌</span>
                                                                    <span class="text-danger fw-medium">Critical Value ({{ level }})</span>
                                                                {% endif %}
                                                            </div>
                                                            <div class="text-end">
                                                                <span class="fw-bold">{{ value|floatformat:4 }}</span>
                                                            </div>
                                                        </div>
                                                    {% endfor %}
                                                </div>
                                            {% else %}
                                                <div class="text-muted text-center p-3">
                                                    <i class="bi bi-info-circle me-2"></i>
                                                    No critical values available
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    
                    <!-- Interpretation Guide -->
                    <div class="card-footer bg-light border-top">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h6 class="mb-2 text-dark">
                                    <i class="bi bi-lightbulb me-2 text-warning"></i>
                                    Interpretation Guide
                                </h6>
                                <p class="mb-0 small text-muted">
                                    A time series is <strong>stationary</strong> if the ADF statistic is less than the critical value. 
                                    Stationary series have constant mean, variance, and autocorrelation over time, making them suitable for many forecasting models.
                                </p>
                            </div>
                            <div class="col-md-4 text-md-end mt-2 mt-md-0">
                                <div class="d-flex flex-column flex-md-row gap-2 justify-content-md-end">
                                    <span class="badge bg-success">✅ Stationary at level</span>
                                    <span class="badge bg-danger">❌ Non-stationary at level</span>
                                </div>
                            </div>
                        </div>
                    </div>
                {% else %}
                    <div class="text-center p-5">
                        <i class="bi bi-exclamation-circle text-muted" style="font-size: 3rem;"></i>
                        <p class="text-muted mt-3 mb-0">No stationarity test results available.</p>
                    </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Series Statistics -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="bi bi-bar-chart me-2"></i> Series Statistics</h5>
            </div>
            <div class="card-body">
                {% if stationarity_results.series_stats %}
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Symbol</th>
                                    <th>Count</th>
                                    <th>Mean</th>
                                    <th>Std Dev</th>
                                    <th>Min</th>
                                    <th>Max</th>
                                    <th>Skewness</th>
                                    <th>Kurtosis</th>
                                    <th>Ann. Vol</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for symbol, stats in stationarity_results.series_stats.items %}
                                <tr>
                                    <td><strong>{{ symbol }}</strong></td>
                                    <td>{{ stats.n|default:"-" }}</td>
                                    <td>{{ stats.mean|floatformat:6|default:"-" }}</td>
                                    <td>{{ stats.std|floatformat:6|default:"-" }}</td>
                                    <td>{{ stats.min|floatformat:6|default:"-" }}</td>
                                    <td>{{ stats.max|floatformat:6|default:"-" }}</td>
                                    <td>{{ stats.skew|floatformat:3|default:"-" }}</td>
                                    <td>{{ stats.kurt|floatformat:3|default:"-" }}</td>
                                    <td>{{ stats.annualized_vol|floatformat:4|default:"-" }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p class="text-muted">No series statistics available.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- ARIMA Tab -->
    <div class="tab-pane fade {% if active_tab == 'arima' %}show active{% endif %}" id="arima" role="tabpanel" aria-labelledby="arima-tab">
        <div class="card mb-4">
            <div class="card-header bg-gradient text-white" style="background: linear-gradient(135deg, #00b894, #00cec9);">
                <h5 class="card-title mb-0">
                    <i class="bi bi-graph-up-arrow me-2"></i> 
                    ARIMA Model Results (AutoRegressive Integrated Moving Average)
                </h5>
                <small class="opacity-75">Time series forecasting models that capture trends, patterns, and temporal dependencies in financial data</small>
            </div>
            <div class="card-body">
                {% if arima_results %}
                    <div class="row g-0">
                        {% for symbol, arima in arima_results.items %}
                            <div class="col-12">
                                <div class="card border-0 border-bottom" style="border-color: #e9ecef !important;">
                                    <div class="card-header bg-light border-0 d-flex align-items-center justify-content-between">
                                        <div>
                                            <h6 class="mb-0 fw-bold text-dark">{{ symbol|upper }}</h6>
                                            <small class="text-muted">ARIMA Model Analysis</small>
                                        </div>
                                        <div class="text-end">
                                            {% if arima.summary.model_specification %}
                                                <span class="badge bg-success rounded-pill px-3 py-2">
                                                    <i class="bi bi-check-circle me-1"></i>{{ arima.summary.model_specification }}
                                                </span>
                                            {% else %}
                                                <span class="badge bg-secondary rounded-pill px-3 py-2">
                                                    <i class="bi bi-gear me-1"></i>Model Fitted
                                                </span>
                                            {% endif %}
                                        </div>
                                    </div>
                                    
                                    <!-- Executive Summary Section -->
                                    <div class="card-body">
                                        {% if arima.interpretation.executive_summary %}
                                            <div class="alert alert-primary border-0 mb-4" style="background-color: #e3f2fd;">
                                                <h6 class="text-primary mb-2 d-flex align-items-center">
                                                    <i class="bi bi-lightbulb me-2"></i>Executive Summary
                                                </h6>
                                                <p class="mb-0">{{ arima.interpretation.executive_summary.bottom_line }}</p>
                                            </div>
                                        {% endif %}
                                        
                                        <!-- Key Findings Section -->
                                        {% if arima.interpretation.key_findings %}
                                            <div class="mb-4">
                                                <h6 class="text-primary mb-3 d-flex align-items-center">
                                                    <i class="bi bi-key me-2"></i>Key Findings
                                                </h6>
                                                <div class="row">
                                                    {% for finding_type, finding_text in arima.interpretation.key_findings.items %}
                                                        {% if finding_text %}
                                                            <div class="col-12 mb-3">
                                                                <div class="card border-0 bg-light">
                                                                    <div class="card-body p-3">
                                                                        <h6 class="card-title text-secondary mb-2">{{ finding_type|title|replace_underscore }}</h6>
                                                                        {% if finding_text is string %}
                                                                            <p class="card-text mb-0">{{ finding_text }}</p>
                                                                        {% elif finding_text.items %}
                                                                            <ul class="mb-0">
                                                                                {% for k, v in finding_text.items %}
                                                                                    <li><strong>{{ k|title|replace_underscore }}:</strong> {{ v }}</li>
                                                                                {% endfor %}
                                                                            </ul>
                                                                        {% else %}
                                                                            <p class="card-text mb-0">{{ finding_text }}</p>
                                                                        {% endif %}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        {% endif %}
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        {% endif %}
                                        
                                        <div class="row">
                                            <!-- Model Summary Section -->
                                            <div class="col-md-6 mb-4">
                                                <h6 class="text-primary mb-3 d-flex align-items-center">
                                                    <i class="bi bi-cpu me-2"></i>Model Summary
                                                </h6>
                                                {% if arima.summary %}
                                                    <div class="row g-3 mb-3">
                                                        <div class="col-6">
                                                            <div class="bg-light rounded p-3 text-center">
                                                                <div class="fw-bold text-dark">{{ arima.summary.aic|floatformat:2|default:"-" }}</div>
                                                                <small class="text-muted">AIC</small>
                                                            </div>
                                                        </div>
                                                        <div class="col-6">
                                                            <div class="bg-light rounded p-3 text-center">
                                                                <div class="fw-bold text-dark">{{ arima.summary.bic|floatformat:2|default:"-" }}</div>
                                                                <small class="text-muted">BIC</small>
                                                            </div>
                                                        </div>
                                                        <div class="col-6">
                                                            <div class="bg-light rounded p-3 text-center">
                                                                <div class="fw-bold text-dark">{{ arima.summary.log_likelihood|floatformat:2|default:"-" }}</div>
                                                                <small class="text-muted">Log Likelihood</small>
                                                            </div>
                                                        </div>
                                                        <div class="col-6">
                                                            <div class="bg-light rounded p-3 text-center">
                                                                <div class="fw-bold text-dark">{{ arima.summary.sample_size|default:"-" }}</div>
                                                                <small class="text-muted">Sample Size</small>
                                                            </div>
                                                        </div>
                                                    </div>
                                                {% else %}
                                                    <div class="text-center p-3">
                                                        <i class="bi bi-info-circle text-muted" style="font-size: 2rem;"></i>
                                                        <p class="text-muted mt-2 mb-0">Model summary not available</p>
                                                    </div>
                                                {% endif %}
                                            </div>
                                            
                                            <!-- Forecast Summary Section -->
                                            <div class="col-md-6 mb-4">
                                                <h6 class="text-primary mb-3 d-flex align-items-center">
                                                    <i class="bi bi-graph-up-arrow me-2"></i>Forecast Summary
                                                </h6>
                                                {% if arima.forecast %}
                                                    <div class="row g-3 mb-3">
                                                        <div class="col-6">
                                                            <div class="bg-light rounded p-3 text-center">
                                                                <div class="fw-bold text-dark">{{ arima.forecast.forecast_steps|default:"-" }}</div>
                                                                <small class="text-muted">Forecast Steps</small>
                                                            </div>
                                                        </div>
                                                        <div class="col-6">
                                                            <div class="bg-light rounded p-3 text-center">
                                                                <div class="fw-bold text-dark">{{ arima.forecast.forecast_method|default:"-" }}</div>
                                                                <small class="text-muted">Method</small>
                                                            </div>
                                                        </div>
                                                        {% if arima.forecast.point_forecasts %}
                                                            <div class="col-12">
                                                                <div class="bg-success bg-opacity-10 rounded p-3 text-center border border-success border-opacity-25">
                                                                    <div class="fw-bold text-success">{{ arima.forecast.point_forecasts.0|floatformat:4 }}</div>
                                                                    <small class="text-success">Next Period Forecast</small>
                                                                </div>
                                                            </div>
                                                        {% endif %}
                                                    </div>
                                                {% else %}
                                                    <div class="text-center p-3">
                                                        <i class="bi bi-exclamation-circle text-muted" style="font-size: 2rem;"></i>
                                                        <p class="text-muted mt-2 mb-0">No forecast data available</p>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        
                                        <!-- Model Parameters Section -->
                                        {% if arima.summary.parameters %}
                                            <div class="mb-4">
                                                <h6 class="text-primary mb-3 d-flex align-items-center">
                                                    <i class="bi bi-sliders me-2"></i>Model Parameters
                                                </h6>
                                                <div class="table-responsive">
                                                    <table class="table table-sm table-bordered">
                                                        <thead class="table-light">
                                                            <tr>
                                                                <th>Parameter</th>
                                                                <th>Value</th>
                                                                <th>P-Value</th>
                                                                <th>Significance</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {% for param, value in arima.summary.parameters.items %}
                                                                <tr>
                                                                    <td class="fw-medium">{{ param }}</td>
                                                                    <td>{{ value|floatformat:4|default:"-" }}</td>
                                                                    <td>{{ arima.summary.parameter_pvalues|lookup:param|floatformat:4|default:"-" }}</td>
                                                                    <td>
                                                                        {% with significance=arima.summary.parameter_significance|lookup:param %}
                                                                            {% if significance == "***" %}
                                                                                <span class="badge bg-success">***</span>
                                                                            {% elif significance == "**" %}
                                                                                <span class="badge bg-warning">**</span>
                                                                            {% elif significance == "*" %}
                                                                                <span class="badge bg-info">*</span>
                                                                            {% else %}
                                                                                <span class="badge bg-secondary">{{ significance|default:"-" }}</span>
                                                                            {% endif %}
                                                                        {% endwith %}
                                                                    </td>
                                                                </tr>
                                                            {% endfor %}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        {% endif %}
                                        
                                        <!-- Residual Statistics Section -->
                                        {% if arima.summary.residual_statistics %}
                                            <div class="mb-4">
                                                <h6 class="text-primary mb-3 d-flex align-items-center">
                                                    <i class="bi bi-bar-chart-line me-2"></i>Residual Statistics
                                                </h6>
                                                <div class="row g-3">
                                                    {% for stat, value in arima.summary.residual_statistics.items %}
                                                        <div class="col-md-3 col-sm-6">
                                                            <div class="bg-light rounded p-3 text-center">
                                                                <div class="fw-bold text-dark">{{ value|floatformat:4|default:"-" }}</div>
                                                                <small class="text-muted">{{ stat|title|replace_underscore }}</small>
                                                            </div>
                                                        </div>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    
                    <!-- Interpretation Guide -->
                    <div class="card-footer bg-light border-top">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h6 class="mb-2 text-dark">
                                    <i class="bi bi-lightbulb me-2 text-warning"></i>
                                    ARIMA Model Guide
                                </h6>
                                <p class="mb-0 small text-muted">
                                    ARIMA models capture <strong>autoregressive</strong> patterns, <strong>differencing</strong> for stationarity, and <strong>moving average</strong> components. 
                                    Lower AIC/BIC values indicate better model fit. Parameter significance: <span class="badge bg-success">***</span> p&lt;0.001, <span class="badge bg-warning">**</span> p&lt;0.01, <span class="badge bg-info">*</span> p&lt;0.05
                                </p>
                            </div>
                            <div class="col-md-4 text-md-end mt-2 mt-md-0">
                                <div class="d-flex flex-column gap-2">
                                    <span class="badge bg-primary">AR: Past values influence</span>
                                    <span class="badge bg-info">MA: Past errors influence</span>
                                </div>
                            </div>
                        </div>
                    </div>
                {% else %}
                    <div class="text-center p-5">
                        <i class="bi bi-exclamation-circle text-muted" style="font-size: 3rem;"></i>
                        <p class="text-muted mt-3 mb-0">No ARIMA results available.</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- ARIMA Analysis Visualizations -->
        {% if plots %}
            {% for symbol in symbols %}
                {% with plot_key='arima_analysis_'|add:symbol|lower %}
                    {% if plots|lookup:plot_key %}
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="bi bi-graph-up-arrow me-2"></i> 
                                    {{ symbol|upper }} - ARIMA Analysis Visualization
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-info mb-3">
                                    <i class="bi bi-info-circle"></i>
                                    <strong>ARIMA Components:</strong> This visualization shows the complete ARIMA analysis for {{ symbol|upper }}, including fitted values vs actual data, residuals analysis, filtered series (with predictable component removed), and forecast projections.
                                    {% if arima_results|lookup:symbol.forecast.forecast_method %}
                                        <br><strong>Forecast Method:</strong> {{ arima_results|lookup:symbol.forecast.forecast_method }}
                                    {% endif %}
                                </div>
                                
                                <div id="arima-plot-{{ symbol|lower }}" class="plotly-chart"></div>
                                <script>
                                    document.addEventListener('DOMContentLoaded', function() {
                                        try {
                                            var plotData = {{ plots|lookup:plot_key|safe }};
                                            Plotly.newPlot('arima-plot-{{ symbol|lower }}', plotData.data, plotData.layout, {
                                                responsive: true,
                                                displayModeBar: true,
                                                displaylogo: false,
                                                modeBarButtonsToRemove: ['pan2d', 'lasso2d', 'select2d']
                                            });
                                        } catch (error) {
                                            console.error('Error rendering ARIMA plot for {{ symbol }}:', error);
                                            document.getElementById('arima-plot-{{ symbol|lower }}').innerHTML = 
                                                '<div class="alert alert-warning">Error loading ARIMA chart for {{ symbol }}. Please try refreshing the page.</div>';
                                        }
                                    });
                                </script>
                            </div>
                        </div>
                    {% endif %}
                {% endwith %}
            {% endfor %}
        {% endif %}
        
    </div>

    <!-- GARCH Tab -->
    <div class="tab-pane fade {% if active_tab == 'garch' %}show active{% endif %}" id="garch" role="tabpanel" aria-labelledby="garch-tab">
        <div class="card mb-4">
            <div class="card-header bg-gradient text-white" style="background: linear-gradient(135deg, #fd79a8, #e84393);">
                <h5 class="card-title mb-0">
                    <i class="bi bi-lightning me-2"></i> 
                    GARCH Model Results (Generalized AutoRegressive Conditional Heteroskedasticity)
                </h5>
                <small class="opacity-75">Volatility modeling that captures time-varying variance and volatility clustering in financial returns</small>
            </div>
            <div class="card-body p-0">
                {% if garch_results %}
                    <div class="row g-0">
                        {% for symbol, garch in garch_results.items %}
                            <div class="col-12">
                                <div class="card border-0 border-bottom" style="border-color: #e9ecef !important;">
                                    <div class="card-header bg-light border-0 d-flex align-items-center justify-content-between">
                                        <div>
                                            <h6 class="mb-0 fw-bold text-dark">{{ symbol|upper }}</h6>
                                            <small class="text-muted">GARCH Volatility Analysis</small>
                                        </div>
                                        <div class="text-end">
                                            {% if garch.interpretation.technical_details.model_specification.order %}
                                                <span class="badge bg-success rounded-pill px-3 py-2">
                                                    <i class="bi bi-check-circle me-1"></i>{{ garch.interpretation.technical_details.model_specification.order }}
                                                </span>
                                            {% else %}
                                                <span class="badge bg-secondary rounded-pill px-3 py-2">
                                                    <i class="bi bi-lightning me-1"></i>GARCH Model
                                                </span>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <!-- Executive Summary Section -->
                                        {% if garch.interpretation.executive_summary %}
                                            <div class="alert alert-primary border-0 mb-4" style="background-color: #e3f2fd;">
                                                <h6 class="text-primary mb-2 d-flex align-items-center">
                                                    <i class="bi bi-lightbulb me-2"></i>Executive Summary
                                                </h6>
                                                <p class="mb-0">{{ garch.interpretation.executive_summary.bottom_line }}</p>
                                            </div>
                                        {% endif %}
                                        
                                        <!-- Key Findings Section -->
                                        {% if garch.interpretation.key_findings %}
                                            <div class="mb-4">
                                                <h6 class="text-primary mb-3 d-flex align-items-center">
                                                    <i class="bi bi-key me-2"></i>Key Findings
                                                </h6>
                                                <div class="row">
                                                    {% for finding_type, finding_data in garch.interpretation.key_findings.items %}
                                                        {% if finding_data %}
                                                            <div class="col-12 mb-3">
                                                                <div class="card border-0 bg-light">
                                                                    <div class="card-body p-3">
                                                                        <h6 class="card-title text-secondary mb-2">{{ finding_type|title|replace_underscore }}</h6>
                                                                        {% if finding_data is string %}
                                                                            <p class="card-text mb-0">{{ finding_data }}</p>
                                                                        {% elif finding_data.items %}
                                                                            <ul class="mb-0">
                                                                                {% for k, v in finding_data.items %}
                                                                                    <li><strong>{{ k|title|replace_underscore }}:</strong> {{ v }}</li>
                                                                                {% endfor %}
                                                                            </ul>
                                                                        {% else %}
                                                                            <p class="card-text mb-0">{{ finding_data }}</p>
                                                                        {% endif %}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        {% endif %}
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        {% endif %}
                                        
                                        <div class="row">
                                            <!-- Model Summary Section -->
                                            <div class="col-md-6 mb-4">
                                                <h6 class="text-primary mb-3 d-flex align-items-center">
                                                    <i class="bi bi-cpu me-2"></i>Model Summary
                                                </h6>
                                                {% if garch.interpretation.technical_details.model_specification %}
                                                    <div class="row g-3 mb-3">
                                                        <div class="col-6">
                                                            <div class="bg-light rounded p-3 text-center">
                                                                <div class="fw-bold text-dark">{{ garch.interpretation.technical_details.model_specification.omega|floatformat:6|default:"-" }}</div>
                                                                <small class="text-muted">Omega (ω)</small>
                                                            </div>
                                                        </div>
                                                        <div class="col-6">
                                                            <div class="bg-light rounded p-3 text-center">
                                                                <div class="fw-bold text-dark">{{ garch.interpretation.technical_details.model_specification.alpha|floatformat:6|default:"-" }}</div>
                                                                <small class="text-muted">Alpha (α)</small>
                                                            </div>
                                                        </div>
                                                        <div class="col-6">
                                                            <div class="bg-light rounded p-3 text-center">
                                                                <div class="fw-bold text-dark">{{ garch.interpretation.technical_details.model_specification.beta|floatformat:6|default:"-" }}</div>
                                                                <small class="text-muted">Beta (β)</small>
                                                            </div>
                                                        </div>
                                                        <div class="col-6">
                                                            <div class="bg-light rounded p-3 text-center">
                                                                <div class="fw-bold text-dark">{{ garch.interpretation.technical_details.model_specification.order|default:"-" }}</div>
                                                                <small class="text-muted">Model Order</small>
                                                            </div>
                                                        </div>
                                                    </div>
                                                {% else %}
                                                    <div class="text-center p-3">
                                                        <i class="bi bi-info-circle text-muted" style="font-size: 2rem;"></i>
                                                        <p class="text-muted mt-2 mb-0">Model specification not available</p>
                                                    </div>
                                                {% endif %}
                                            </div>
                                            
                                            <!-- Volatility Forecast Section -->
                                            <div class="col-md-6 mb-4">
                                                <h6 class="text-primary mb-3 d-flex align-items-center">
                                                    <i class="bi bi-graph-up-arrow me-2"></i>Volatility Forecast
                                                </h6>
                                                {% if garch.forecast %}
                                                    <div class="row g-3 mb-3">
                                                        <div class="col-6">
                                                            <div class="bg-light rounded p-3 text-center">
                                                                <div class="fw-bold text-dark">{{ garch.forecast|length }}</div>
                                                                <small class="text-muted">Forecast Periods</small>
                                                            </div>
                                                        </div>
                                                        <div class="col-6">
                                                            <div class="bg-light rounded p-3 text-center">
                                                                <div class="fw-bold text-dark">{{ garch.interpretation.technical_details.forecast_statistics.mean_forecast|floatformat:6|default:"-" }}</div>
                                                                <small class="text-muted">Mean Forecast</small>
                                                            </div>
                                                        </div>
                                                        {% if garch.forecast.0 %}
                                                            <div class="col-12">
                                                                <div class="bg-warning bg-opacity-10 rounded p-3 text-center border border-warning border-opacity-25">
                                                                    <div class="fw-bold text-warning">{{ garch.forecast.0|floatformat:6 }}</div>
                                                                    <small class="text-warning">Next Period Volatility</small>
                                                                </div>
                                                            </div>
                                                        {% endif %}
                                                    </div>
                                                {% else %}
                                                    <div class="text-center p-3">
                                                        <i class="bi bi-exclamation-circle text-muted" style="font-size: 2rem;"></i>
                                                        <p class="text-muted mt-2 mb-0">No forecast data available</p>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        
                                        <!-- Volatility Mechanics Section -->
                                        {% if garch.interpretation.technical_details.volatility_mechanics %}
                                            <div class="mb-4">
                                                <h6 class="text-primary mb-3 d-flex align-items-center">
                                                    <i class="bi bi-sliders me-2"></i>Volatility Mechanics
                                                </h6>
                                                <div class="row g-3">
                                                    <div class="col-md-4 col-sm-6">
                                                        <div class="bg-light rounded p-3 text-center">
                                                            <div class="fw-bold text-dark">{{ garch.interpretation.technical_details.volatility_mechanics.persistence|floatformat:4|default:"-" }}</div>
                                                            <small class="text-muted">Persistence</small>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4 col-sm-6">
                                                        <div class="bg-light rounded p-3 text-center">
                                                            <div class="fw-bold text-dark">{{ garch.interpretation.technical_details.volatility_mechanics.half_life|floatformat:2|default:"-" }}</div>
                                                            <small class="text-muted">Half Life</small>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4 col-sm-6">
                                                        <div class="bg-light rounded p-3 text-center">
                                                            <div class="fw-bold text-dark">{{ garch.interpretation.technical_details.volatility_mechanics.unconditional_variance|floatformat:6|default:"-" }}</div>
                                                            <small class="text-muted">Unconditional Variance</small>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endif %}
                                        
                                        <!-- Forecast Statistics Section -->
                                        {% if garch.interpretation.technical_details.forecast_statistics %}
                                            <div class="mb-4">
                                                <h6 class="text-primary mb-3 d-flex align-items-center">
                                                    <i class="bi bi-bar-chart-line me-2"></i>Forecast Statistics
                                                </h6>
                                                <div class="row g-3">
                                                    <div class="col-md-3 col-sm-6">
                                                        <div class="bg-light rounded p-3 text-center">
                                                            <div class="fw-bold text-dark">{{ garch.interpretation.technical_details.forecast_statistics.forecast_volatility|floatformat:6|default:"-" }}</div>
                                                            <small class="text-muted">Forecast Volatility</small>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3 col-sm-6">
                                                        <div class="bg-light rounded p-3 text-center">
                                                            <div class="fw-bold text-dark">{{ garch.interpretation.technical_details.forecast_statistics.total_change|floatformat:4|default:"-" }}</div>
                                                            <small class="text-muted">Total Change</small>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6 col-sm-12">
                                                        <div class="bg-light rounded p-3 text-center">
                                                            <div class="fw-bold text-dark">{{ garch.interpretation.technical_details.forecast_statistics.forecast_range|default:"-" }}</div>
                                                            <small class="text-muted">Forecast Range</small>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endif %}
                                        
                                        <!-- Model Summary Text Section -->
                                        {% if garch.summary %}
                                            <div class="mb-4">
                                                <h6 class="text-primary mb-3 d-flex align-items-center">
                                                    <i class="bi bi-file-text me-2"></i>Model Output Summary
                                                </h6>
                                                <div class="bg-light p-3 rounded">
                                                    <small class="font-monospace">{{ garch.summary|truncatechars:400 }}</small>
                                                </div>
                                            </div>
                                        {% endif %}
                                        
                                        <!-- Technical Details Section -->
                                        {% if garch.interpretation.technical_details %}
                                            <div class="mb-4">
                                                <h6 class="text-primary mb-3 d-flex align-items-center">
                                                    <i class="bi bi-gear me-2"></i>Technical Details
                                                </h6>
                                                <div class="row">
                                                    {% if garch.interpretation.technical_details.model_specification.justification %}
                                                        <div class="col-12 mb-3">
                                                            <div class="card border-0 bg-light">
                                                                <div class="card-body p-3">
                                                                    <h6 class="card-title text-secondary mb-2">Model Specification</h6>
                                                                    <p class="card-text mb-0">{{ garch.interpretation.technical_details.model_specification.justification }}</p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    {% endif %}
                                                    {% if garch.interpretation.technical_details.volatility_mechanics.justification %}
                                                        <div class="col-12 mb-3">
                                                            <div class="card border-0 bg-light">
                                                                <div class="card-body p-3">
                                                                    <h6 class="card-title text-secondary mb-2">Volatility Mechanics</h6>
                                                                    <p class="card-text mb-0">{{ garch.interpretation.technical_details.volatility_mechanics.justification }}</p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        {% endif %}
                                        
                                        <!-- Forecast Values Table -->
                                        {% if garch.forecast and garch.forecast|length > 1 %}
                                            <div class="mb-4">
                                                <h6 class="text-primary mb-3 d-flex align-items-center">
                                                    <i class="bi bi-table me-2"></i>Detailed Forecast Values
                                                </h6>
                                                <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                                                    <table class="table table-sm table-striped">
                                                        <thead class="table-light sticky-top">
                                                            <tr>
                                                                <th>Period</th>
                                                                <th>Volatility Forecast</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {% for forecast_val in garch.forecast %}
                                                                <tr>
                                                                    <td class="fw-medium">{{ forloop.counter }}</td>
                                                                    <td>{{ forecast_val|floatformat:6 }}</td>
                                                                </tr>
                                                            {% endfor %}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    
                    <!-- Interpretation Guide -->
                    <div class="card-footer bg-light border-top">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h6 class="mb-2 text-dark">
                                    <i class="bi bi-lightbulb me-2 text-warning"></i>
                                    GARCH Model Guide
                                </h6>
                                <p class="mb-0 small text-muted">
                                    GARCH models capture <strong>volatility clustering</strong> where high volatility periods are followed by high volatility. 
                                    Parameters: <span class="badge bg-info">ω (constant)</span> <span class="badge bg-warning">α (ARCH effect)</span> <span class="badge bg-success">β (persistence)</span>. 
                                    Higher α+β indicates stronger volatility persistence.
                                </p>
                            </div>
                            <div class="col-md-4 text-md-end mt-2 mt-md-0">
                                <div class="d-flex flex-column gap-2">
                                    <span class="badge bg-danger">High α: Strong shock impact</span>
                                    <span class="badge bg-primary">High β: Long memory</span>
                                </div>
                            </div>
                        </div>
                    </div>
                {% else %}
                    <div class="text-center p-5">
                        <i class="bi bi-exclamation-circle text-muted" style="font-size: 3rem;"></i>
                        <p class="text-muted mt-3 mb-0">No GARCH results available.</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- GARCH Analysis Visualizations -->
        {% if plots %}
            {% for symbol in symbols %}
                {% with plot_key='garch_analysis_'|add:symbol|lower %}
                    {% if plots|lookup:plot_key %}
                        <div class="card mb-4">
                            <div class="card-header">
                                                               <h5 class="card-title mb-0">
                                    <i class="bi bi-lightning me-2"></i> 
                                    {{ symbol|upper }} - GARCH Analysis Visualization
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-info mb-3">
                                    <i class="bi bi-info-circle"></i>
                                    <strong>GARCH Components:</strong> This visualization shows the complete GARCH volatility analysis for {{ symbol|upper }}, including conditional volatility, standardized residuals, volatility clustering patterns, and volatility forecasts.
                                    {% if garch_results|lookup:symbol.interpretation.technical_details.model_specification.order %}
                                        <br><strong>Model Order:</strong> {{ garch_results|lookup:symbol.interpretation.technical_details.model_specification.order }}
                                    {% endif %}
                                </div>
                                
                                <div id="garch-plot-{{ symbol|lower }}" class="plotly-chart"></div>
                                <script>
                                    document.addEventListener('DOMContentLoaded', function() {
                                        try {
                                            var plotData = {{ plots|lookup:plot_key|safe }};
                                            Plotly.newPlot('garch-plot-{{ symbol|lower }}', plotData.data, plotData.layout, {
                                                responsive: true,
                                                displayModeBar: true,
                                                displaylogo: false,
                                                modeBarButtonsToRemove: ['pan2d', 'lasso2d', 'select2d']
                                            });
                                        } catch (error) {
                                            console.error('Error rendering GARCH plot for {{ symbol }}:', error);
                                            document.getElementById('garch-plot-{{ symbol|lower }}').innerHTML = 
                                                '<div class="alert alert-warning">Error loading GARCH chart for {{ symbol }}. Please try refreshing the page.</div>';
                                        }
                                    });
                                </script>
                            </div>
                        </div>
                    {% endif %}
                {% endwith %}
            {% endfor %}
        {% endif %}
    </div>

    <!-- Spillover Analysis Tab -->
    {% if spillover_enabled %}
    <div class="tab-pane fade {% if active_tab == 'spillover' %}show active{% endif %}" id="spillover" role="tabpanel" aria-labelledby="spillover-tab">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="bi bi-arrows-angle-expand"></i> Spillover Analysis Results</h5>
            </div>
            <div class="card-body">
                {% if spillover_results %}
                    {% if spillover_results.total_spillover_index %}
                        <div class="alert alert-primary">
                            <h6><strong>Total Spillover Index:</strong> {{ spillover_results.total_spillover_index|floatformat:2 }}%</h6>
                            <p>This indicates the percentage of forecast error variance that comes from spillovers between assets.</p>
                        </div>
                    {% endif %}
                    
                    {% if spillover_results.interpretation %}
                        <div class="alert alert-info">
                            <strong>Interpretation:</strong> {{ spillover_results.interpretation }}
                        </div>
                    {% endif %}
                    
                    {% if spillover_results.spillover_table_data %}
                        <h6>Directional Spillover</h6>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Asset</th>
                                        <th>Spillover TO Others (%)</th>
                                        <th>Spillover FROM Others (%)</th>
                                        <th>Net Spillover (%)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for row in spillover_results.spillover_table_data %}
                                        <tr>
                                            <td><strong>{{ row.symbol }}</strong></td>
                                            <td>{{ row.spillover_to|floatformat:2|default:"-" }}</td>
                                            <td>{{ row.spillover_from|floatformat:2|default:"-" }}</td>
                                            <td>
                                                {% if row.net_spillover_positive %}
                                                    <span class="text-success">+{{ row.net_spillover|floatformat:2 }}</span>
                                                {% elif row.net_spillover %}
                                                    <span class="text-danger">{{ row.net_spillover|floatformat:2 }}</span>
                                                {% else %}
                                                    <span class="text-muted">{{ row.net_spillover|floatformat:2 }}</span>
                                                {% endif %}
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% endif %}
                {% else %}
                    <p class="text-muted">No spillover analysis results available.</p>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Granger Causality Tab -->
    <div class="tab-pane fade {% if active_tab == 'granger-causality' %}show active{% endif %}" id="granger-causality" role="tabpanel" aria-labelledby="granger-causality-tab">
        <div class="card mb-4">
            <div class="card-header bg-gradient text-white" style="background: linear-gradient(135deg, #e17055, #d63031);">
                <h5 class="card-title mb-0">
                    <i class="bi bi-arrow-through-heart me-2"></i> 
                    Granger Causality & Vector Autoregression Analysis
                </h5>
                <small class="opacity-75">Statistical analysis of predictive relationships and interconnections between time series variables</small>
            </div>
            <div class="card-body p-0">
                {% if granger_causality_results.causality_results or var_results.interpretation %}
                    
                    <!-- VAR Model Interpretation Section -->
                    {% if var_results.interpretation %}
                    <div class="card border-0 border-bottom mb-0" style="border-color: #e9ecef !important;">
                        <div class="card-header bg-light border-0">
                            <h6 class="mb-0 fw-bold text-dark">
                                <i class="bi bi-bezier2 me-2"></i>Vector Autoregression (VAR) Model Overview
                            </h6>
                            <small class="text-muted">Multivariate time series model capturing dynamic relationships</small>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-primary border-0" style="background-color: #e3f2fd;">
                                <p class="mb-0">{{ var_results.interpretation }}</p>
                            </div>
                            
                            {% if var_results.selected_lag %}
                            <div class="row g-3 mb-3">
                                <div class="col-md-3">
                                    <div class="bg-light rounded p-3 text-center">
                                        <div class="fw-bold text-dark">{{ var_results.selected_lag }}</div>
                                        <small class="text-muted">Selected Lag</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="bg-light rounded p-3 text-center">
                                        <div class="fw-bold text-dark">{{ var_results.ic_used|default:"AIC" }}</div>
                                        <small class="text-muted">Selection Criterion</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="bg-light rounded p-3 text-center">
                                        <div class="fw-bold text-dark">{{ symbols|length }}</div>
                                        <small class="text-muted">Variables</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="bg-light rounded p-3 text-center">
                                        <div class="fw-bold text-dark">{{ var_results.total_parameters|default:"-" }}</div>
                                        <small class="text-muted">Total Parameters</small>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- Granger Causality Results Section -->
                    {% if granger_causality_results.causality_results %}
                    <div class="card border-0 border-bottom mb-0" style="border-color: #e9ecef !important;">
                        <div class="card-header bg-light border-0">
                            <h6 class="mb-0 fw-bold text-dark">
                                <i class="bi bi-arrow-through-heart me-2"></i>Granger Causality Test Results
                            </h6>
                            <small class="text-muted">Statistical tests for predictive relationships between variables</small>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>Causal Relationship</th>
                                            <th class="text-center">Significant at 5%</th>
                                            <th class="text-center">Significant at 1%</th>
                                            <th class="text-center">Min P-Value</th>
                                            <th class="text-center">Optimal Lag</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for relationship, test in granger_causality_results.causality_results.items %}
                                            <tr>
                                                <td>
                                                    <strong>{{ relationship }}</strong>
                                                    {% if test.significance_summary.significant_at_5pct %}
                                                        <span class="badge bg-success ms-2">Significant</span>
                                                    {% endif %}
                                                </td>
                                                <td class="text-center">
                                                    {% if test.significance_summary.significant_at_5pct %}
                                                        <span class="badge bg-success">
                                                            <i class="bi bi-check-circle"></i> Yes
                                                        </span>
                                                    {% else %}
                                                        <span class="badge bg-secondary">
                                                            <i class="bi bi-x-circle"></i> No
                                                        </span>
                                                    {% endif %}
                                                </td>
                                                <td class="text-center">
                                                    {% if test.significance_summary.significant_at_1pct %}
                                                        <span class="badge bg-success">
                                                            <i class="bi bi-check-circle"></i> Yes
                                                        </span>
                                                    {% else %}
                                                        <span class="badge bg-secondary">
                                                            <i class="bi bi-x-circle"></i> No
                                                        </span>
                                                    {% endif %}
                                                </td>
                                                <td class="text-center">
                                                    <code>{{ test.significance_summary.min_p_value|floatformat:4|default:"-" }}</code>
                                                </td>
                                                <td class="text-center">
                                                    {{ test.optimal_lag|default:"-" }}
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Detailed Interpretations Section -->
                    {% if granger_causality_results.interpretations %}
                    <div class="card border-0 border-bottom mb-0" style="border-color: #e9ecef !important;">
                        <div class="card-header bg-light border-0">
                            <h6 class="mb-0 fw-bold text-dark">
                                <i class="bi bi-chat-left-text me-2"></i>Detailed Relationship Interpretations
                            </h6>
                            <small class="text-muted">In-depth analysis of each causal relationship</small>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                {% for relationship, interpretation in granger_causality_results.interpretations.items %}
                                    <div class="col-lg-6 mb-4">
                                        <div class="card border h-100">
                                            <div class="card-header d-flex align-items-center justify-content-between">
                                                <div>
                                                    <h6 class="mb-0 text-primary">{{ relationship }}</h6>
                                                    <small class="text-muted">Causal Direction Analysis</small>
                                                </div>
                                                <div>
                                                    {% if "Significant Causality" in interpretation %}
                                                        <span class="badge bg-success">
                                                            <i class="bi bi-arrow-right"></i> Causal
                                                        </span>
                                                    {% else %}
                                                        <span class="badge bg-secondary">
                                                            <i class="bi bi-dash"></i> No Causality
                                                        </span>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="card-body">
                                                <p class="mb-0 text-justify">{{ interpretation }}</p>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- FEVD Matrix Section -->
                    {% if var_results.fevd_matrix %}
                    <div class="card border-0 border-bottom mb-0" style="border-color: #e9ecef !important;">
                        <div class="card-header bg-light border-0">
                            <h6 class="mb-0 fw-bold text-dark">
                                <i class="bi bi-grid-3x3 me-2"></i>Forecast Error Variance Decomposition (FEVD) Matrix
                            </h6>
                            <small class="text-muted">Shows how forecast errors in each variable are explained by innovations in other variables</small>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info mb-3">
                                <i class="bi bi-info-circle"></i>
                                <strong>FEVD Matrix:</strong> Each cell (i,j) shows the percentage of forecast error variance in variable i explained by innovations in variable j. Row sums equal 100%.
                            </div>
                            
                            <div class="table-responsive">
                                <table class="table table-bordered table-hover">
                                    <thead class="table-dark text-center">
                                        <tr>
                                            <th>Variable</th>
                                            {% for symbol in symbols %}
                                                <th>{{ symbol }}</th>
                                            {% endfor %}
                                            <th class="bg-secondary">Total (%)</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for i, symbol in symbols|enumerate_list %}
                                            <tr>
                                                <th class="bg-light text-center">{{ symbol }}</th>
                                                {% for j, target_symbol in symbols|enumerate_list %}
                                                    <td class="text-center">
                                                        {% with value=var_results.fevd_matrix|index:i|index:j %}
                                                            {% if i == j %}
                                                                <strong class="text-primary">{{ value|floatformat:1 }}%</strong>
                                                            {% elif value > 20 %}
                                                                <span class="text-danger fw-bold">{{ value|floatformat:1 }}%</span>
                                                            {% elif value > 10 %}
                                                                <span class="text-warning fw-medium">{{ value|floatformat:1 }}%</span>
                                                            {% else %}
                                                                <span class="text-muted">{{ value|floatformat:1 }}%</span>
                                                            {% endif %}
                                                        {% endwith %}
                                                    </td>
                                                {% endfor %}
                                                <td class="text-center bg-light">
                                                    <strong>100.0%</strong>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="row mt-3">
                                <div class="col-md-8">
                                    <small class="text-muted">
                                        <span class="text-primary">■</span> Own innovations (diagonal) &nbsp;
                                        <span class="text-danger">■</span> High external influence (>20%) &nbsp;
                                        <span class="text-warning">■</span> Moderate external influence (10-20%) &nbsp;
                                        <span class="text-muted">■</span> Low external influence (<10%)
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- FEVD Interpretations Section -->
                    {% if var_results.fevd_interpretation %}
                    <div class="card border-0 border-bottom mb-0" style="border-color: #e9ecef !important;">
                        <div class="card-header bg-light border-0">
                            <h6 class="mb-0 fw-bold text-dark">
                                <i class="bi bi-chat-dots me-2"></i>FEVD Analysis by Variable
                            </h6>
                            <small class="text-muted">Detailed breakdown of forecast error variance sources for each variable</small>
                        </div>
                        <div class="card-body">
                            {% for symbol, interpretation in var_results.fevd_interpretation.items %}
                                <div class="card mb-3 border-start border-primary border-3">
                                    <div class="card-header bg-light d-flex align-items-center">
                                        <h6 class="mb-0 text-primary">{{ symbol|upper }}</h6>
                                        <span class="badge bg-primary ms-auto">FEVD Analysis</span>
                                    </div>
                                    <div class="card-body">
                                        <p class="mb-0 text-justify">{{ interpretation }}</p>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- Spillover Results Section -->
                    {% if spillover_results %}
                    <div class="card border-0 border-bottom mb-0" style="border-color: #e9ecef !important;">
                        <div class="card-header bg-light border-0">
                            <h6 class="mb-0 fw-bold text-dark">
                                <i class="bi bi-arrows-angle-expand me-2"></i>Spillover Analysis Results
                            </h6>
                            <small class="text-muted">Comprehensive analysis of shock transmission between variables</small>
                        </div>
                        <div class="card-body">
                            
                            <!-- Total Spillover Index -->
                            {% if spillover_results.total_spillover_index %}
                            <div class="alert alert-primary mb-4">
                                <div class="d-flex align-items-center justify-content-between">
                                    <div>
                                        <h5 class="mb-1">
                                            <i class="bi bi-speedometer2 me-2"></i>
                                            Total Spillover Index: {{ spillover_results.total_spillover_index|floatformat:2 }}%
                                        </h5>
                                        <p class="mb-0">Overall level of interconnectedness and shock transmission in the system</p>
                                    </div>
                                    <div class="text-center">
                                        {% if spillover_results.total_spillover_index > 70 %}
                                            <span class="badge bg-danger fs-6 p-2">High Spillover</span>
                                        {% elif spillover_results.total_spillover_index > 40 %}
                                            <span class="badge bg-warning fs-6 p-2">Moderate Spillover</span>
                                        {% else %}
                                            <span class="badge bg-success fs-6 p-2">Low Spillover</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% endif %}

                            <!-- Directional Spillover Table -->
                            {% if spillover_results.directional_spillover %}
                            <div class="mb-4">
                                <h6 class="text-primary mb-3">
                                    <i class="bi bi-arrow-left-right me-2"></i>Directional Spillover Effects
                                </h6>
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover">
                                        <thead class="table-dark">
                                            <tr>
                                                <th>Asset</th>
                                                <th class="text-center">Spillover TO Others (%)</th>
                                                <th class="text-center">Spillover FROM Others (%)</th>
                                                <th class="text-center">Net Spillover (%)</th>
                                                <th class="text-center">Role</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for symbol in symbols %}
                                                {% with spillover_data=spillover_results.directional_spillover|lookup:symbol %}
                                                    {% with net_spillover=spillover_results.net_spillover|lookup:symbol %}
                                                        <tr>
                                                            <td><strong>{{ symbol|upper }}</strong></td>
                                                            <td class="text-center">
                                                                <span class="badge bg-info">{{ spillover_data.to|floatformat:2 }}%</span>
                                                            </td>
                                                            <td class="text-center">
                                                                <span class="badge bg-warning">{{ spillover_data.from|floatformat:2 }}%</span>
                                                            </td>
                                                            <td class="text-center">
                                                                {% if net_spillover > 0 %}
                                                                    <span class="text-success fw-bold">+{{ net_spillover|floatformat:2 }}%</span>
                                                                {% elif net_spillover < 0 %}
                                                                    <span class="text-danger fw-bold">{{ net_spillover|floatformat:2 }}%</span>
                                                                {% else %}
                                                                    <span class="text-muted fw-bold">{{ net_spillover|floatformat:2 }}%</span>
                                                                {% endif %}
                                                            </td>
                                                            <td class="text-center">
                                                                {% if net_spillover > 5 %}
                                                                    <span class="badge bg-success">Net Transmitter</span>
                                                                {% elif net_spillover < -5 %}
                                                                    <span class="badge bg-danger">Net Receiver</span>
                                                                {% else %}
                                                                    <span class="badge bg-secondary">Neutral</span>
                                                                {% endif %}
                                                            </td>
                                                        </tr>
                                                    {% endwith %}
                                                {% endwith %}
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            {% endif %}

                            <!-- Pairwise Spillover Matrix -->
                            {% if spillover_results.pairwise_spillover %}
                            <div class="mb-4">
                                <h6 class="text-primary mb-3">
                                    <i class="bi bi-grid me-2"></i>Pairwise Spillover Matrix
                                </h6>
                                <div class="alert alert-info mb-3">
                                    <i class="bi bi-info-circle"></i>
                                    <strong>Pairwise Spillover:</strong> Each cell (i,j) shows the spillover from variable j to variable i. Diagonal elements are zero by definition.
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-bordered">
                                        <thead class="table-dark text-center">
                                            <tr>
                                                <th>From \ To</th>
                                                {% for symbol in symbols %}
                                                    <th>{{ symbol }}</th>
                                                {% endfor %}
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for from_symbol in symbols %}
                                                <tr>
                                                    <th class="bg-light text-center">{{ from_symbol }}</th>
                                                    {% for to_symbol in symbols %}
                                                        <td class="text-center">
                                                            {% if from_symbol == to_symbol %}
                                                                <span class="text-muted">—</span>
                                                            {% else %}
                                                                {% with spillover_value=spillover_results.pairwise_spillover|lookup:from_symbol|lookup:to_symbol %}
                                                                    {% if spillover_value > 15 %}
                                                                        <span class="text-danger fw-bold">{{ spillover_value|floatformat:2 }}%</span>
                                                                    {% elif spillover_value > 8 %}
                                                                        <span class="text-warning fw-medium">{{ spillover_value|floatformat:2 }}%</span>
                                                                    {% else %}
                                                                        <span class="text-muted">{{ spillover_value|floatformat:2 }}%</span>
                                                                    {% endif %}
                                                                {% endwith %}
                                                            {% endif %}
                                                        </td>
                                                    {% endfor %}
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                <div class="mt-2">
                                    <small class="text-muted">
                                        <span class="text-danger">■</span> Strong spillover (>15%) &nbsp;
                                        <span class="text-warning">■</span> Moderate spillover (8-15%) &nbsp;
                                        <span class="text-muted">■</span> Weak spillover (<8%)
                                    </small>
                                </div>
                            </div>
                            {% endif %}

                            <!-- Spillover Interpretation -->
                            {% if spillover_results.interpretation %}
                            <div class="alert alert-light">
                                <h6 class="text-primary mb-2">
                                    <i class="bi bi-lightbulb me-2"></i>Spillover Analysis Summary
                                </h6>
                                <p class="mb-0">{{ spillover_results.interpretation }}</p>
                            </div>
                            {% endif %}

                        </div>
                    </div>
                    {% endif %}

                    <!-- Interpretation Guide -->
                    <div class="card-footer bg-light border-top">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h6 class="mb-2 text-dark">
                                    <i class="bi bi-lightbulb me-2 text-warning"></i>
                                    Granger Causality & VAR Guide
                                </h6>
                                <p class="mb-0 small text-muted">
                                    <strong>Granger Causality</strong> tests if past values of X help predict Y beyond Y's own history. 
                                    <strong>FEVD</strong> shows forecast error variance sources. 
                                    <strong>Spillover</strong> measures shock transmission between variables. 
                                    Significance levels: <span class="badge bg-success">5%</span> moderate, <span class="badge bg-danger">1%</span> strong evidence.
                                </p>
                            </div>
                            <div class="col-md-4 text-md-end mt-2 mt-md-0">
                                <div class="d-flex flex-column gap-2">
                                    <span class="badge bg-info">VAR: Dynamic relationships</span>
                                    <span class="badge bg-warning">FEVD: Variance sources</span>
                                    <span class="badge bg-danger">Spillover: Shock transmission</span>
                                </div>
                            </div>
                        </div>
                    </div>

                {% else %}
                    <div class="text-center p-5">
                        <i class="bi bi-exclamation-circle text-muted" style="font-size: 3rem;"></i>
                        <p class="text-muted mt-3 mb-0">No Granger causality or VAR analysis results available.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Concepts Tab -->
    <div class="tab-pane fade {% if active_tab == 'explainer' %}show active{% endif %}" id="explainer" role="tabpanel" aria-labelledby="explainer-tab">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="bi bi-question-circle"></i> Analysis Background & Context</h5>
            </div>
            <div class="card-body">
                <div class="alert alert-info mb-4">
                    <i class="bi bi-info-circle"></i>
                    <strong>Background Context:</strong> This section provides detailed background information and context for the time series analysis, including explanations of the models used and their interpretation.
                </div>

                {% if stationarity_results.all_symbols_stationarity %}
                    <!-- Extract stationarity background context from first symbol -->
                    {% for symbol, test_result in stationarity_results.all_symbols_stationarity.items %}
                        {% if test_result.interpretation.background_context and forloop.first %}
                            <div class="card mb-4">
                                <div class="card-header bg-light">
                                    <h6 class="mb-0">
                                        <i class="bi bi-activity me-2"></i>
                                        Stationarity Testing Background Context
                                    </h6>
                                </div>
                                <div class="card-body">
                                    {% for context_key, context_value in test_result.interpretation.background_context.items %}
                                        <div class="mb-3">
                                            <h6 class="text-primary">{{ context_key|title|replace_underscore }}</h6>
                                            {% if context_value is string %}
                                                <p class="mb-0">{{ context_value }}</p>
                                            {% elif context_value.items %}
                                                <ul class="mb-0">
                                                    {% for k, v in context_value.items %}
                                                        <li><strong>{{ k|title|replace_underscore }}:</strong> {{ v }}</li>
                                                    {% endfor %}
                                                </ul>
                                            {% else %}
                                                <p class="mb-0">{{ context_value }}</p>
                                            {% endif %}
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}
                {% endif %}

                {% if arima_results %}
                    <!-- Extract background context from first symbol (since it's the same for all) -->
                    {% for symbol, arima in arima_results.items %}
                        {% if arima.interpretation.background_context and forloop.first %}
                            <div class="card mb-4">
                                <div class="card-header bg-light">
                                    <h6 class="mb-0">
                                        <i class="bi bi-graph-up-arrow me-2"></i>
                                        ARIMA Modeling Background Context
                                    </h6>
                                </div>
                                <div class="card-body">
                                    {% for context_key, context_value in arima.interpretation.background_context.items %}
                                        <div class="mb-3">
                                            <h6 class="text-primary">{{ context_key|title|replace_underscore }}</h6>
                                            {% if context_value is string %}
                                                <p class="mb-0">{{ context_value }}</p>
                                            {% elif context_value.items %}
                                                <ul class="mb-0">
                                                    {% for k, v in context_value.items %}
                                                        <li><strong>{{ k|title|replace_underscore }}:</strong> {{ v }}</li>
                                                    {% endfor %}
                                                </ul>
                                            {% else %}
                                                <p class="mb-0">{{ context_value }}</p>
                                            {% endif %}
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}
                {% endif %}

                {% if garch_results %}
                    <!-- Extract GARCH background context from first symbol -->
                    {% for symbol, garch in garch_results.items %}
                        {% if garch.interpretation.background_context and forloop.first %}
                            <div class="card mb-4">
                                <div class="card-header bg-light">
                                    <h6 class="mb-0">
                                        <i class="bi bi-lightning me-2"></i>
                                        GARCH Modeling Background Context
                                    </h6>
                                </div>
                                <div class="card-body">
                                    {% for context_key, context_value in garch.interpretation.background_context.items %}
                                        <div class="mb-3">
                                            <h6 class="text-primary">{{ context_key|title|replace_underscore }}</h6>
                                            {% if context_value is string %}
                                                <p class="mb-0">{{ context_value }}</p>
                                            {% elif context_value.items %}
                                                <ul class="mb-0">
                                                    {% for k, v in context_value.items %}
                                                        <li><strong>{{ k|title|replace_underscore }}:</strong> {{ v }}</li>
                                                    {% endfor %}
                                                </ul>
                                            {% else %}
                                                <p class="mb-0">{{ context_value }}</p>
                                            {% endif %}
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}
                {% endif %}

                <!-- Granger Causality & Spillover Analysis Background Context -->
                <div class="card mb-4">
                    <div class="card-header bg-light">
                        <h6 class="mb-0">
                            <i class="bi bi-arrow-through-heart me-2"></i>
                            Granger Causality & Spillover Analysis Background Context
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <h6 class="text-primary">What Is Granger Causality</h6>
                            <p class="mb-0">Granger causality is a statistical test that determines whether past values of one time series (X) help predict future values of another time series (Y) beyond what Y's own past values can predict. Named after Nobel Prize winner Clive Granger, it doesn't imply true causation but rather "predictive causality" - if X Granger-causes Y, then X contains useful information for forecasting Y. The test works by comparing two models: one that uses only Y's past values to predict Y, and another that uses both Y's and X's past values. If the second model significantly improves prediction accuracy, we conclude that X Granger-causes Y.</p>
                        </div>
                        
                        <div class="mb-3">
                            <h6 class="text-primary">Why It Matters</h6>
                            <p class="mb-0">In financial markets, Granger causality reveals lead-lag relationships between assets, sectors, or economic indicators. For example, if oil prices Granger-cause airline stock returns, this suggests oil price movements contain predictive information about future airline performance. This knowledge is invaluable for risk management, portfolio construction, and trading strategies. It helps identify leading indicators, understand market transmission mechanisms, and build more sophisticated forecasting models. However, it's crucial to remember that Granger causality reflects correlation patterns in historical data and may not persist in the future.</p>
                        </div>
                        
                        <div class="mb-3">
                            <h6 class="text-primary">Diebold-Yilmaz Spillover Methodology</h6>
                            <p class="mb-0">The Diebold-Yilmaz spillover methodology, developed by Francis Diebold and Kamil Yilmaz, provides a comprehensive framework for measuring interconnectedness in financial markets. It builds on Vector Autoregression (VAR) models and Forecast Error Variance Decomposition (FEVD) to quantify how shocks in one market or asset propagate to others. The methodology produces a "spillover index" that measures the percentage of forecast error variance that comes from spillovers between variables, rather than from each variable's own innovations. This approach has become the gold standard for analyzing financial contagion, systemic risk, and market interconnectedness.</p>
                        </div>
                        
                        <div class="mb-3">
                            <h6 class="text-primary">Forecast Error Variance Decomposition (FEVD)</h6>
                            <p class="mb-0">FEVD is a core component of spillover analysis that breaks down the forecast error variance of each variable into portions attributable to its own shocks versus shocks from other variables in the system. For example, if we're analyzing three stocks (A, B, C), FEVD tells us what percentage of stock A's forecast errors come from its own price movements versus movements in stocks B and C. This decomposition reveals the relative importance of different sources of uncertainty and helps identify which variables are most influential in the system. FEVD forms the foundation for calculating directional spillovers (from specific sources to specific targets) and the total spillover index.</p>
                        </div>
                        
                        <div class="mb-3">
                            <h6 class="text-primary">Practical Applications</h6>
                            <ul class="mb-0">
                                <li><strong>Risk Management:</strong> Identify assets that tend to move together during stress periods</li>
                                <li><strong>Portfolio Diversification:</strong> Find assets with low spillover connections for better diversification</li>
                                <li><strong>Systemic Risk Assessment:</strong> Measure overall market interconnectedness and contagion potential</li>
                                <li><strong>Trading Strategies:</strong> Exploit lead-lag relationships between assets</li>
                                <li><strong>Regulatory Policy:</strong> Understand how shocks propagate through financial systems</li>
                                <li><strong>Crisis Analysis:</strong> Study how financial crises spread across markets and countries</li>
                            </ul>
                        </div>
                        
                        <div class="mb-3">
                            <h6 class="text-primary">Interpretation Guidelines</h6>
                            <ul class="mb-0">
                                <li><strong>Significance Levels:</strong> 1% significance indicates very strong evidence of Granger causality; 5% indicates moderate evidence</li>
                                <li><strong>Net Spillover:</strong> Positive values indicate a variable is a net transmitter of shocks; negative values indicate a net receiver</li>
                                <li><strong>Total Spillover Index:</strong> Higher values (>50%) suggest high market interconnectedness; lower values indicate more independent markets</li>
                                <li><strong>Directional Spillovers:</strong> Show the flow of shocks from specific sources to targets, helping identify transmission channels</li>
                                <li><strong>Time Variation:</strong> Spillover patterns can change over time, especially during crisis periods when correlations typically increase</li>
                            </ul>
                        </div>
                        
                        <div class="mb-0">
                            <h6 class="text-primary">Limitations And Considerations</h6>
                            <ul class="mb-0">
                                <li><strong>Linear Relationships:</strong> Standard Granger causality tests assume linear relationships and may miss nonlinear dependencies</li>
                                <li><strong>Stationarity Requirement:</strong> Variables must be stationary or properly transformed for valid inference</li>
                                <li><strong>Lag Selection:</strong> Results can be sensitive to the chosen lag length in VAR models</li>
                                <li><strong>Structural Breaks:</strong> Relationships may change during crisis periods or regime shifts</li>
                                <li><strong>Contemporaneous Effects:</strong> Standard analysis focuses on lagged relationships and may miss same-period interactions</li>
                                <li><strong>Sample Size:</strong> Reliable results require sufficient data, typically 100+ observations</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Pipeline Tab -->
    <div class="tab-pane fade {% if active_tab == 'data-lineage' %}show active{% endif %}" id="data-lineage-pane" role="tabpanel" aria-labelledby="data-lineage-tab">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="bi bi-diagram-3"></i> Data Lineage & Transformation Pipeline</h5>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <i class="bi bi-info-circle-fill"></i>
                    <strong>Data Transformation Pipeline:</strong> View the data at each stage of the analysis pipeline. Each tab shows data as it flows through the transformation process from original prices to model-ready formats.
                </div>
                
                <!-- Data Stage Navigation -->
                <ul class="nav nav-pills mb-4" id="dataLineageTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="original-data-tab" data-bs-toggle="pill" data-bs-target="#original-data-stage" 
                                type="button" role="tab" aria-controls="original-data-stage" aria-selected="true">
                            <i class="bi bi-currency-dollar"></i> Original Prices
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="returns-data-tab" data-bs-toggle="pill" data-bs-target="#returns-data-stage" 
                                type="button" role="tab" aria-controls="returns-data-stage" aria-selected="false">
                            <i class="bi bi-graph-up"></i> Returns
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="scaled-data-tab" data-bs-toggle="pill" data-bs-target="#scaled-data-stage" 
                                type="button" role="tab" aria-controls="scaled-data-stage" aria-selected="false">
                            <i class="bi bi-arrows-fullscreen"></i> Scaled for GARCH
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="pre-garch-data-tab" data-bs-toggle="pill" data-bs-target="#pre-garch-data-stage" 
                                type="button" role="tab" aria-controls="pre-garch-data-stage" aria-selected="false">
                            <i class="bi bi-box-arrow-in-right"></i> Pre-GARCH
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="post-garch-data-tab" data-bs-toggle="pill" data-bs-target="#post-garch-data-stage" 
                                type="button" role="tab" aria-controls="post-garch-data-stage" aria-selected="false">
                            <i class="bi bi-box-arrow-right"></i> Post-GARCH
                        </button>
                    </li>
                </ul>
                
                <!-- Data Stage Content -->
                <div class="tab-content" id="dataLineageTabsContent">
                    
                    <!-- Original Data Stage -->
                    <div class="tab-pane fade show active" id="original-data-stage" role="tabpanel" aria-labelledby="original-data-tab">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div>
                                <h6><i class="bi bi-currency-dollar"></i> Original Price Data</h6>
                                <p class="text-muted mb-0">Raw financial data as received from the data source</p>
                            </div>
                            <div>
                                <a href="{% url 'timeseries:export_csv' 'original_data' %}" 
                                   class="btn btn-success btn-sm">
                                    <i class="bi bi-download"></i> Export CSV
                                </a>
                            </div>
                        </div>
                        
                        {% if data_arrays.original_data %}
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <div class="bg-light p-2 rounded">
                                        <small><strong>Records:</strong> {{ data_arrays.original_data.count }}</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="bg-light p-2 rounded">
                                        <small><strong>Symbols:</strong> {{ symbols|join:", " }}</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="bg-light p-2 rounded">
                                        <small><strong>Type:</strong> Price Levels</small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                <table class="table table-striped table-sm">
                                    <thead class="table-dark sticky-top">
                                        <tr>
                                            <th>Date</th>
                                            {% for symbol in symbols %}
                                                <th>{{ symbol }}</th>
                                            {% endfor %}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for timestamp in data_arrays.original_data.timestamps|slice:":10" %}
                                            <tr>
                                                <td>{{ timestamp }}</td>
                                                {% for symbol in symbols %}
                                                    <td>{{ data_arrays.original_data.symbol_data|lookup:symbol|index:forloop.parentloop.counter0|floatformat:4 }}</td>
                                                {% endfor %}
                                            </tr>
                                                                               {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% if data_arrays.original_data.count > 10 %}
                                <div class="text-muted text-center mt-2">
                                    <small>Showing first 10 of {{ data_arrays.original_data.count }} records. Export to CSV for full dataset.</small>
                                </div>
                            {% endif %}
                        {% else %}
                            <p class="text-muted">No original data available.</p>
                        {% endif %}
                    </div>
                    
                    <!-- Returns Data Stage -->
                    <div class="tab-pane fade" id="returns-data-stage" role="tabpanel" aria-labelledby="returns-data-tab">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div>
                                <h6><i class="bi bi-graph-up"></i> Returns Data</h6>
                                <p class="text-muted mb-0">Logarithmic returns calculated from price data</p>
                            </div>
                            <div>
                                <a href="{% url 'timeseries:export_csv' 'returns_data' %}" 
                                   class="btn btn-success btn-sm">
                                    <i class="bi bi-download"></i> Export CSV
                                </a>
                            </div>
                        </div>
                        
                        {% if data_arrays.returns_data %}
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <div class="bg-light p-2 rounded">
                                        <small><strong>Records:</strong> {{ data_arrays.returns_data.count }}</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="bg-light p-2 rounded">
                                        <small><strong>Symbols:</strong> {{ symbols|join:", " }}</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="bg-light p-2 rounded">
                                        <small><strong>Type:</strong> Log Returns</small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                <table class="table table-striped table-sm">
                                    <thead class="table-dark sticky-top">
                                        <tr>
                                            <th>Date</th>
                                            {% for symbol in symbols %}
                                                <th>{{ symbol }}</th>
                                            {% endfor %}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for timestamp in data_arrays.returns_data.timestamps|slice:":10" %}
                                            <tr>
                                                <td>{{ timestamp }}</td>
                                                {% for symbol in symbols %}
                                                    <td>{{ data_arrays.returns_data.symbol_data|lookup:symbol|index:forloop.parentloop.counter0|floatformat:6 }}</td>
                                                {% endfor %}
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% if data_arrays.returns_data.count > 10 %}
                                <div class="text-muted text-center mt-2">
                                    <small>Showing first 10 of {{ data_arrays.returns_data.count }} records. Export to CSV for full dataset.</small>
                                </div>
                            {% endif %}
                        {% else %}
                            <p class="text-muted">No returns data available.</p>
                        {% endif %}
                    </div>
                    
                    <!-- Scaled Data Stage -->
                    <div class="tab-pane fade" id="scaled-data-stage" role="tabpanel" aria-labelledby="scaled-data-tab">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div>
                                <h6><i class="bi bi-arrows-fullscreen"></i> Scaled Data for GARCH</h6>
                                <p class="text-muted mb-0">Standardized returns data prepared for GARCH modeling</p>
                            </div>
                            <div>
                                <a href="{% url 'timeseries:export_csv' 'scaled_data' %}" 
                                   class="btn btn-success btn-sm">
                                    <i class="bi bi-download"></i> Export CSV
                                </a>
                            </div>
                        </div>
                        
                        {% if data_arrays.scaled_data %}
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <div class="bg-light p-2 rounded">
                                        <small><strong>Records:</strong> {{ data_arrays.scaled_data.count }}</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="bg-light p-2 rounded">
                                        <small><strong>Symbols:</strong> {{ symbols|join:", " }}</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="bg-light p-2 rounded">
                                        <small><strong>Type:</strong> Standardized Returns</small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                <table class="table table-striped table-sm">
                                    <thead class="table-dark sticky-top">
                                        <tr>
                                            <th>Date</th>
                                            {% for symbol in symbols %}
                                                <th>{{ symbol }}</th>
                                            {% endfor %}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for timestamp in data_arrays.scaled_data.timestamps|slice:":10" %}
                                            <tr>
                                                <td>{{ timestamp }}</td>
                                                {% for symbol in symbols %}
                                                    <td>{{ data_arrays.scaled_data.symbol_data|lookup:symbol|index:forloop.parentloop.counter0|floatformat:6 }}</td>
                                                {% endfor %}
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% if data_arrays.scaled_data.count > 10 %}
                                <div class="text-muted text-center mt-2">
                                    <small>Showing first 10 of {{ data_arrays.scaled_data.count }} records. Export to CSV for full dataset.</small>
                                </div>
                            {% endif %}
                        {% else %}
                            <p class="text-muted">No scaled data available.</p>
                        {% endif %}
                    </div>
                    
                    <!-- Pre-GARCH Data Stage -->
                    <div class="tab-pane fade" id="pre-garch-data-stage" role="tabpanel" aria-labelledby="pre-garch-data-tab">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div>
                                <h6><i class="bi bi-box-arrow-in-right"></i> Pre-GARCH Data</h6>
                                <p class="text-muted mb-0">Data prepared and ready for GARCH model input</p>
                            </div>
                            <div>
                                <a href="{% url 'timeseries:export_csv' 'pre_garch_data' %}" 
                                   class="btn btn-success btn-sm">
                                    <i class="bi bi-download"></i> Export CSV
                                </a>
                            </div>
                        </div>
                        
                        {% if data_arrays.pre_garch_data %}
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <div class="bg-light p-2 rounded">
                                        <small><strong>Records:</strong> {{ data_arrays.pre_garch_data.count }}</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="bg-light p-2 rounded">
                                        <small><strong>Symbols:</strong> {{ symbols|join:", " }}</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="bg-light p-2 rounded">
                                        <small><strong>Type:</strong> GARCH Input</small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                <table class="table table-striped table-sm">
                                    <thead class="table-dark sticky-top">
                                        <tr>
                                            <th>Date</th>
                                            {% for symbol in symbols %}
                                                <th>{{ symbol }}</th>
                                            {% endfor %}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for timestamp in data_arrays.pre_garch_data.timestamps|slice:":10" %}
                                            <tr>
                                                <td>{{ timestamp }}</td>
                                                {% for symbol in symbols %}
                                                    <td>{{ data_arrays.pre_garch_data.symbol_data|lookup:symbol|index:forloop.parentloop.counter0|floatformat:6 }}</td>
                                                {% endfor %}
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% if data_arrays.pre_garch_data.count > 10 %}
                                <div class="text-muted text-center mt-2">
                                    <small>Showing first 10 of {{ data_arrays.pre_garch_data.count }} records. Export to CSV for full dataset.</small>
                                </div>
                            {% endif %}
                        {% else %}
                            <p class="text-muted">No pre-GARCH data available.</p>
                        {% endif %}
                    </div>
                    
                    <!-- Post-GARCH Data Stage -->
                    <div class="tab-pane fade" id="post-garch-data-stage" role="tabpanel" aria-labelledby="post-garch-data-tab">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div>
                                <h6><i class="bi bi-box-arrow-right"></i> Post-GARCH Data</h6>
                                <p class="text-muted mb-0">Data after GARCH volatility modeling and residual extraction</p>
                            </div>
                            <div>
                                <a href="{% url 'timeseries:export_csv' 'post_garch_data' %}" 
                                   class="btn btn-success btn-sm">
                                    <i class="bi bi-download"></i> Export CSV
                                </a>
                            </div>
                        </div>
                        
                        {% if data_arrays.post_garch_data %}
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <div class="bg-light p-2 rounded">
                                        <small><strong>Records:</strong> {{ data_arrays.post_garch_data.count }}</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="bg-light p-2 rounded">
                                        <small><strong>Symbols:</strong> {{ symbols|join:", " }}</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="bg-light p-2 rounded">
                                        <small><strong>Type:</strong> GARCH Output</small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                <table class="table table-striped table-sm">
                                    <thead class="table-dark sticky-top">
                                        <tr>
                                            <th>Date</th>
                                            {% for symbol in symbols %}
                                                <th>{{ symbol }}</th>
                                            {% endfor %}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for timestamp in data_arrays.post_garch_data.timestamps|slice:":10" %}
                                                                                       <tr>
                                                <td>{{ timestamp }}</td>
                                                {% for symbol in symbols %}
                                                    <td>{{ data_arrays.post_garch_data.symbol_data|lookup:symbol|index:forloop.parentloop.counter0|floatformat:6 }}</td>
                                                {% endfor %}
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% if data_arrays.post_garch_data.count > 10 %}
                                <div class="text-muted text-center mt-2">
                                    <small>Showing first 10 of {{ data_arrays.post_garch_data.count }} records. Export to CSV for full dataset.</small>
                                </div>
                            {% endif %}
                        {% else %}
                            <p class="text-muted">No post-GARCH data available.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Ensure Plotly charts resize when the Time Series or ARIMA tab is shown
function resizePlotsForTab(tabSelector, plotIdPrefix, plotIdList) {
    var tab = document.querySelector(tabSelector);
    if (tab) {
        tab.addEventListener('shown.bs.tab', function() {
            // Resize all static plots
            plotIdList.forEach(function(id) {
                var el = document.getElementById(id);
                if (el && el.children.length > 0) {
                    try { Plotly.Plots.resize(el); } catch (e) {}
                }
            });
            // Resize all ARIMA analysis plots (dynamic per symbol)
            if (plotIdPrefix) {
                document.querySelectorAll('[id^="' + plotIdPrefix + '"]').forEach(function(el) {
                    if (el && el.children.length > 0) {
                        try { Plotly.Plots.resize(el); } catch (e) {}
                    }
                });
            }
        });
    }
}

document.addEventListener('DOMContentLoaded', function() {
    // Time Series tab
    resizePlotsForTab(
        'button[data-bs-target="#time-series"]',
        null,
        [
            'original-data-plot',
            'returns-data-plot',
            'scaled-data-plot',
            'pre-garch-plot',
            'post-garch-plot'
        ]
    );
    // ARIMA tab (dynamic per symbol)
    resizePlotsForTab(
        'button[data-bs-target="#arima"]',
        'arima-plot-',
        []
    );
});
</script>

{% endif %}
{% endblock %}
